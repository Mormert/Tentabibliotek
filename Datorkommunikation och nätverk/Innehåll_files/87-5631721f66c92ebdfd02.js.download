(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{"1ZbL":function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var s=r("D57K"),i=r("5MwF"),o=r("nsO7"),n=r("ERkP"),a=r("7nmT"),u=r("0JpG"),c=r("8unJ"),l=r("jbsW"),m=r("uDfI"),p=function(){function e(){this.__isFirstRender=!0,this.state={},this.props={}}return e.prototype.$onChanges=function(e){var t=this.props,r=Object(o.mapValues)(e,"currentValue"),s=Object(o.assign)({},this.props,r);if(this.__isFirstRender)Object(o.assign)(this,{props:s}),this.componentWillMount(),this.render(),this.__isFirstRender=!1;else{if(!this.didPropsChange(r,t))return;this.componentWillReceiveProps(s);var i=this.shouldComponentUpdate(s,this.state);if(Object(o.assign)(this,{props:s}),!i)return;this.componentWillUpdate(this.props,this.state),this.render(),this.componentDidUpdate(this.props,this.state)}},e.prototype.$postLink=function(){this.componentDidMount()},e.prototype.$onDestroy=function(){this.componentWillUnmount()},e.prototype.didPropsChange=function(e,t){return Object(o.some)(e,(function(e,r){return e!==t[r]}))},e.prototype.componentWillMount=function(){},e.prototype.componentDidMount=function(){},e.prototype.componentWillReceiveProps=function(e){},e.prototype.shouldComponentUpdate=function(e,t){return!0},e.prototype.componentWillUpdate=function(e,t){},e.prototype.componentDidUpdate=function(e,t){},e.prototype.componentWillUnmount=function(){},e.prototype.render=function(){},e}();function h(e){return function(t){function r(r){for(var s=[],i=1;i<arguments.length;i++)s[i-1]=arguments[i];var o=t.call(this)||this;return o.$element=r,o.injectedProps={},e.injectNames.forEach((function(e,t){o.injectedProps[e]=s[t]})),o}return Object(s.__extends)(r,t),r.prototype.render=function(){var t=n.createElement(e.Class,Object(s.__assign)(Object(s.__assign)({},this.injectedProps),this.props),null);e.renderLocalized&&(t=this.localizeComponent(t)),e.withProvider&&(t=this.providedComponent(t)),Object(a.render)(t,this.$element[0])},r.prototype.providedComponent=function(e){var t={store:this.injectedProps.$ngRedux};return n.createElement(m.Provider,t,e)},r.prototype.localizeComponent=function(e){var t=this.injectedProps[u.serviceName],r={locale:t.getLocale(this.injectedProps.$scope),babelfishInstance:t.intl,babelfishFormatInstance:t.frmt};return i.a.unitTesting&&(r.mockLocalize=Object(l.getLocalizeMock)()),n.createElement(c.Locale,r,e)},r.prototype.componentWillUnmount=function(){Object(a.unmountComponentAtNode)(this.$element[0])},r}(p)}function d(e){e.injectNames=e.injectNames||[];var t=e.bindingNames||e.Class.propTypes&&Object.keys(e.Class.propTypes)||[],r=e.attributes||[];return e.renderLocalized&&(-1===e.injectNames.indexOf("$scope")&&e.injectNames.push("$scope"),-1===e.injectNames.indexOf(u.serviceName)&&e.injectNames.push(u.serviceName)),e.withProvider&&-1===e.injectNames.indexOf("$ngRedux")&&e.injectNames.push("$ngRedux"),{bindings:Object(s.__assign)(Object(s.__assign)({},Object(o.fromPairs)(t.map((function(e){return[e,"<"]})))),Object(o.fromPairs)(r.map((function(e){return[e,"@"]})))),controller:Object(s.__spreadArrays)(["$element"],e.injectNames,[h(e)])}}},BjFu:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return b}));var s=r("D57K"),i=r("nsO7"),o=r("wHJ2"),n=r("yC9S"),a=r("Fvsw"),u=r("go4a"),c=r("pjml"),l=r("zdqs"),m=r("SoDU"),p=r("fYJU"),h=r("aHpC"),d="ultra.service.termMembership",b="termMembership",f=function(){function e(e,t,r,s,i,o,a,u,c){var l=this;this.$q=e,this.context=r,this.CourseModel=s,this.CourseMembershipModel=i,this.TermModel=o,this.UserModel=a,this.ExternalCourseModel=u,this.contextUser=c,n.b.OnRootScope(t,"courseUltraStatusChanged",(function(e,t,r){l.updateCourseUltraStatus(t,r)}))}return e.prototype.clear=function(){this.termsAndMemberships=void 0,this.loadPromise=void 0},e.prototype.getTermsAndMemberships=function(){return this.loadPromise?this.loadPromise:this.reloadTermsAndMemberships()},e.prototype.filterMemberships=function(e,t,r){return e&&Array.isArray(e)?e.filter((function(e){return!e.course.isOrganization===t||!!e.course.isOrganization===r})):[]},e.prototype.getCourseMembershipsFromArray=function(e){return this.filterMemberships(e,!0,!1)},e.prototype.getOrganizationMembershipsFromArray=function(e){return this.filterMemberships(e,!1,!0)},e.prototype.parseMembershipFromExternalCourse=function(e){var t=this.CourseMembershipModel.$new();return t.course=this.CourseModel.$new(),t.course.id=e.id,t.course.name=e.title,t.course.description=e.description,t.course.displayName=e.title,t.course.startDate=e.startDate,t.course.endDate=e.endDate,t.course.isAvailable=!0,t.course.durationType=c.o.CourseDuration.DateRange,t.userId=e.userId,t.isAvailable=!0,t.userHasHidden=e.isHidden,t.courseCardColorIndex=parseInt((e.id||"0").replace(/_1$/,"").replace(/[^\d]/g,""),10),t.course.ui={courseColorClass:u.a(t),courseBannerImage:t.getBannerImageFilename(),courseBannerImageThumbnail:t.getBannerImageThumbnailFilename(),isExternal:!0,description:e.description,externalUrl:e.url},t},e.prototype.parseExternalCourseFromMembership=function(e){var t=this.ExternalCourseModel.$new(e.course.id);return t.id=e.course.id,t.title=e.course.name,t.startDate=e.course.startDate,t.endDate=e.course.endDate,t.userId=e.userId,t.description=e.course.ui.description,t.url=e.course.ui.externalUrl,t.isHidden=e.userHasHidden,t},e.prototype.fetchMemberships=function(e){return e.memberships.$fetch({limit:1e4,expand:"course.effectiveAvailability,course.permissions,courseRole"}).$asPromise()},e.prototype.reloadTermsAndMemberships=function(){var e=this,t=this.$q.defer();this.loadPromise=t.promise,this.termsAndMemberships={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};var r=this.context.getServerTime();return this.$q.all([this.getInternalMembership(),this.getExternalCoursesMembership(),this.updateTermsAndMemberships()]).then((function(s){var o=s[0],n=s[1];e.termsAndMemberships.membershipsByTermId=Object.create(null),e.termsAndMemberships.memberships.splice(0,e.termsAndMemberships.memberships.length),o.forEach((function(t){e.termsAndMemberships.memberships.push(t)})),n.forEach((function(t){e.termsAndMemberships.memberships.push(t)})),e.associateTermsWithCourses(),e.applyTermAvailability();var a=new m.a(e.TermModel,e.termsAndMemberships.terms),u=new l.a(a).map(e.termsAndMemberships.memberships,r);(u=e.applyStudentAvailabilityRules(u)).forEach((function(t){var r=function(r){var s=e.termsAndMemberships.membershipsByTermId[r.id];s||(s=e.termsAndMemberships.membershipsByTermId[r.id]={memberships:[]}),s.memberships.push(t.membership)};r(t.term);var s=t.membership.course.term;!s||t.term!==a.currentTerm&&t.term!==a.upcomingTerm||r(s),e.buildTermRelationships(t)})),Object.keys(e.termsAndMemberships.membershipsByTermId).forEach((function(t){var r=e.termsAndMemberships.membershipsByTermId[t];r.memberships=i.sortBy(r.memberships,(function(e){return e.course.name}))})),t.resolve(e.termsAndMemberships)})),this.loadPromise},e.prototype.getInternalMembership=function(){var e=this,t=this.UserModel.$new(this.contextUser.userId);return this.fetchMemberships(t).then((function(t){return t.forEach((function(e){e.course&&(e.course.term&&(e.course.term.id=e.course.term.$pk),e.course.ui={courseColorClass:u.a(e),courseBannerImage:e.getBannerImageFilename(),courseBannerImageThumbnail:e.getBannerImageThumbnailFilename()})})),e.getActiveMemberships(t)}))},e.prototype.getActiveMemberships=function(e){return e.filter((function(e){return e.course&&e.isAvailable}))},e.prototype.getExternalCoursesMembership=function(){var e=this;return this.ExternalCourseModel.$search({limit:1e4}).$asPromise().then((function(t){return t.map((function(t){return e.parseMembershipFromExternalCourse(t)}))}))},e.prototype.updateTermsAndMemberships=function(){var e=this;return this.TermModel.$search().$asPromise().then((function(t){e.termsAndMemberships.terms=i.orderBy(t,["startDate","durationType"],["asc","desc"]);var r=m.a.decorateTerm(new e.TermModel,c.Nb.ConstantTermId.CurrentTerm.toString()),s=m.a.decorateTerm(new e.TermModel,c.Nb.ConstantTermId.UpcomingTerm.toString());e.termsAndMemberships.terms.push(r,s)}))},e.prototype.associateTermsWithCourses=function(){var e=this;this.termsAndMemberships.memberships.forEach((function(t){t.course.term&&(t.course.term=e.termsAndMemberships.terms.find((function(e){return e.id===t.course.term.id})))}))},e.prototype.applyTermAvailability=function(){this.termsAndMemberships.memberships.forEach((function(e){if(c.o.CourseDuration.UseTerm.isEqualTo(e.course.durationType)){var t=e.course.term;t&&Object.prototype.hasOwnProperty.call(t,"isAvailable")&&(e.course.isHonorTermAvailability?e.course.isAvailable=t.isAvailable:e.course.term.isAvailable||(e.course.isAvailable=!1))}}))},e.prototype.buildTermRelationships=function(e){var t=this.termsAndMemberships.termsByTermId[e.term.id];if(e.membership.course.term){if(e.term.id!==e.membership.course.term.id){if(!t)return void(this.termsAndMemberships.termsByTermId[e.term.id]=[e.membership.course.term]);t.indexOf(e.membership.course.term)<0&&t.push(e.membership.course.term)}}else;this.termsAndMemberships.termsByTermId[e.term.id]=i.orderBy(t,["startDate","name"],["desc","asc"])},e.prototype.applyStudentAvailabilityRules=function(e){return e.filter((function(e){return e.membership.isStudentOrGuestMembership()&&(e.membership.course.isUndecided()?e.membership.course.isAvailable=!1:c.Nb.ConstantTermId.UpcomingTerm.isEqualTo(e.term.id)&&(e.membership.course.isAvailable=!1)),!0}))},e.prototype.getCourseMembership=function(e){var t=this.findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==t)return this.termsAndMemberships.memberships[t]},e.prototype.findCourseMembership=function(e,t){return t.findIndex((function(t){return t.course.id===e}))},e.prototype.updateCourseUltraStatus=function(e,t){var r=this,s=this.findCourseMembership(e,this.termsAndMemberships.memberships);-1!==s&&(this.termsAndMemberships.memberships[s].course.ultraStatus=t),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((function(i){-1!==(s=r.findCourseMembership(e,r.termsAndMemberships.membershipsByTermId[i].memberships))&&(r.termsAndMemberships.membershipsByTermId[i].memberships[s].course.ultraStatus=t)}))},e.prototype.filterAssociatedWithTermCourseMembershipsByTerm=function(e,t){return this.filterAssociatedWithTermCourseMemberships(e).filter((function(e){return e.course.term.id===t.id}))},e.prototype.filterAssociatedWithTermCourseMemberships=function(e){return e.filter((function(e){return e.course.term&&!c.o.CourseDuration.Continuous.isEqualTo(e.course.term.durationType)}))},e.prototype.filterAssortedDatesCourseMemberships=function(e){return e.filter((function(e){return null==e.course.term||e.course.term&&c.o.CourseDuration.Continuous.isEqualTo(e.course.term.durationType)}))},e=Object(s.__decorate)([Object(s.__param)(0,Object(h.b)("$q")),Object(s.__param)(1,Object(h.b)("$rootScope")),Object(s.__param)(2,Object(h.b)(a.b)),Object(s.__param)(3,Object(h.b)(c.o.serviceName)),Object(s.__param)(4,Object(h.b)(c.v.serviceName)),Object(s.__param)(5,Object(h.b)(c.Nb.serviceName)),Object(s.__param)(6,Object(h.b)(c.Qb.serviceName)),Object(s.__param)(7,Object(h.b)(c.B.serviceName)),Object(s.__param)(8,Object(h.b)(p.b))],e)}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(s.__extends)(t,e)}(f);o.module(d,[a.a,c.R]).service(b,f)},Ego9:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return u}));var s=r("D57K"),i=r("wHJ2"),o=r("pjml"),n=r("Fvsw"),a="ultraUi.components.services.courseFavorite",u="courseFavorite",c=function(){function e(e,t){this.$q=e,this.contextService=t,this.userPreferenceFavoriteCoursesKey="favorite.courses",this.favoriteCourses={}}return Object.defineProperty(e.prototype,"favoriteCourseIds",{get:function(){return Object.keys(this.favoriteCourses)},enumerable:!0,configurable:!0}),e.prototype.fetchFavoriteCourseIds=function(){var e=this;return this.contextService.getPreference(this.userPreferenceFavoriteCoursesKey).then((function(t){return t&&t.value?(e.favoriteCourses=JSON.parse(t.value),Object.keys(e.favoriteCourses)):[]}),(function(e){return[]})).catch((function(e){return[]}))},e.prototype.pin=function(e){this.isPinned(e)||(this.favoriteCourses[e.id]=!0,this.contextService.setPreference(this.userPreferenceFavoriteCoursesKey,JSON.stringify(this.favoriteCourses)))},e.prototype.unpin=function(e){this.isPinned(e)&&(delete this.favoriteCourses[e.id],this.contextService.setPreference(this.userPreferenceFavoriteCoursesKey,JSON.stringify(this.favoriteCourses)))},e.prototype.clear=function(e){var t=this;e&&e.length>0&&(e.forEach((function(e){delete t.favoriteCourses[e]})),this.contextService.setPreference(this.userPreferenceFavoriteCoursesKey,JSON.stringify(this.favoriteCourses)))},e.prototype.isPinned=function(e){return this.favoriteCourses[e.id]},e.prototype._fakeFavorites=function(e){var t=this;e&&e.length&&e.forEach((function(e){e&&(t.favoriteCourses[e]=!0)}))},e.$inject=["$q",n.b],e}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(s.__extends)(t,e)}(c);i.module(a,[o.R,n.a]).service(u,c)},QIw5:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return m})),r.d(t,"a",(function(){return p}));var s=r("D57K"),i=r("wHJ2"),o=r("nbDY"),n=r.n(o),a=r("pjml"),u=r("TnpK"),c=r("Fvsw"),l="ultra.components.services.routing",m="routing",p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.Already=new t("Already"),t.Failure=new t("Failure"),t.Unavailable=new t("Unavailable"),t}(n.a),h=function(){function e(e,t,r){this.CourseModel=e,this.ultraState=t,this.contextService=r}return e.prototype.goToPostRegistrationPage=function(e){var t=this;"succeeded"!==e.enrollStatusCode&&"alreadyEnrolledInCourse"!==e.enrollStatusCode||!e.courseId?e.courseId&&"invalidInput"===e.enrollStatusCode?this.ultraState.go("base.courses",{enrollmentMessage:p.Failure}):this.contextService.getLandingPage().then((function(e){return t.ultraState.go(e)})):this.CourseModel.$find(e.courseId,{fields:"isAvailable"}).$then((function(r){r.isAvailable?"succeeded"===e.enrollStatusCode?t.ultraState.goPeekState("course.outline",{courseId:e.courseId}):"alreadyEnrolledInCourse"===e.enrollStatusCode&&t.ultraState.goPeekState("course.outline",{courseId:e.courseId,enrollmentMessage:p.Already}):t.ultraState.go("base.courses",{enrollmentMessage:p.Unavailable})}))},e.$inject=[a.o.serviceName,u.d,c.b],e}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(s.__extends)(t,e)}(h);i.module(l,[u.b]).service(m,h)},S1rJ:function(e,t){e.exports='<bb-modal class="js-course-status-modal-{{currentCourseStatus.toString()}} notification" modal-title-key="{{currentCourseStatus.getModalTitle()}}"\n          modal-dismiss-key="{{currentCourseStatus.getModalDismissText()}}"\n          analytics-id-tag-prefix="{{currentAnalyticsId}}">\n  <div name="modal-contents">\n    <p bb-translate="{{currentCourseStatus.getModalText()}}"></p>\n  </div>\n  <span name="modal-footer-button-primary">\n    <button ng-if="currentCourseStatus.getPrimaryButtonText()" \n            ng-click="$parent.$close(currentCourseStatus.getPrimaryButtonStatus())" \n            class="button js-primary-button js-course-status-{{currentCourseStatus.getPrimaryButtonStatus()}}"\n            analytics-id="{{currentAnalyticsId}}.primaryButton.button">\n      <span bb-translate="{{currentCourseStatus.getPrimaryButtonText()}}"></span>\n    </button>\n  </span>\n  <span name="modal-footer-button-secondary">\n    <button ng-click="$parent.$close(currentCourseStatus.getSecondaryButtonStatus())" \n            class="button button--secondary js-secondary-button js-course-status-{{currentCourseStatus.getSecondaryButtonStatus()}}"\n            analytics-id="{{currentAnalyticsId}}.close.button">\n      <span bb-translate="{{currentCourseStatus.getSecondaryButtonText()}}"></span>\n    </button>\n  </span>\n</bb-modal>'},SoDU:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var s=r("VdDF"),i=r("pjml"),o=function(){function e(e,t){this.TermModel=e,this.terms=t,this.currentTerm=this.getTerm(i.Nb.ConstantTermId.CurrentTerm.toString()),this.upcomingTerm=this.getTerm(i.Nb.ConstantTermId.UpcomingTerm.toString())}return e.prototype.getTerm=function(e){return this.terms.filter((function(t){return t.id===e}))[0]},e.decorateTerm=function(e,t){return e.id=t,e.ui={type:t},e},e.prototype.createYearTerm=function(e){var t=e.getFullYear(),r="year-"+t,s=this.getTerm(r);return s||((s=new this.TermModel).id=r,s.ui={type:"year",year:t},s.startDate=new Date(t,0),this.addTerm(s)),s},e.prototype.addTerm=function(e){if(e)for(var t=0;t<this.terms.length;t++)if(this.terms[t].startDate>=e.startDate||this.terms[t]===this.currentTerm)return void this.terms.splice(t,0,e)},e.prototype.filterTerm=function(e){return this.terms.filter((function(t){return!!i.Nb.TermDuration.DateRange.isEqualTo(t.durationType)&&s.a.isWithinDateRange(e,{start:t.startDate,end:t.endDate})}))},e}()},"k+3c":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("ZQey"),i=function(e,t,r,s,i,o,n,a,u){this.modalTitle=e,this.modalText=t,this.secondaryButtonText=r,this.primaryButtonText=s,this.modalDismissText=i,this.secondaryButtonStatus=o,this.primaryButtonStatus=n,this.courseStatusName=a,this.courseDescription=u},o=function(){function e(){}return e.Open=new i(".openCourse.modalTitle",".openCourse.modalText",".openCourse.makePrivate",".openCourse.makeComplete","global.cancelTakeMeBack","PRIVATE","COMPLETE",".openCourse.courseStatus",".openCourse.courseDescription"),e.Complete=new i(".completeCourse.modalTitle",".completeCourse.modalText",".completeCourse.makeOpen",".completeCourse.makePrivate","global.cancelTakeMeBack","OPEN","PRIVATE",".completeCourse.courseStatus",".completeCourse.courseDescription"),e.Private=new i(".privateCourse.modalTitle",".privateCourse.modalText","global.cancel",".privateCourse.makeOpen","","","OPEN",".privateCourse.courseStatus",".privateCourse.courseDescription"),e.OpenTermClassic=new i(".openTermClassicCourse.modalTitle",".openTermClassicCourse.modalText","global.cancel","","","","OPEN",".openTermClassicCourse.courseStatus",".openTermClassicCourse.courseDescription"),e.PrivateTermClassic=new i(".privateTermClassicCourse.modalTitle",".privateTermClassicCourse.modalText","global.cancel","","","","PRIVATE",".privateTermClassicCourse.courseStatus",".privateTermClassicCourse.courseDescription"),e.TermOpen=new i(".openTermCourse.modalTitle",".openTermCourse.modalText","global.cancel",".openTermCourse.makeComplete","","","COMPLETE",".openTermCourse.courseStatus",".openTermCourse.courseDescription"),e.TermComplete=new i(".completeTermCourse.modalTitle",".completeTermCourse.modalText","global.cancel",".completeTermCourse.makeOpen","","","OPEN",".completeTermCourse.courseStatus",".completeTermCourse.courseDescription"),e.TermPrivate=new i(".privateTermCourse.modalTitle",".privateTermCourse.modalText","global.cancel","","","","OPEN",".privateTermCourse.courseStatus",".privateTermCourse.courseDescription"),e.OpenClassic=new i(".openClassicCourse.modalTitle",".openClassicCourse.modalText","global.cancel",".openClassicCourse.makePrivate","","","PRIVATE",".openClassicCourse.courseStatus",".openClassicCourse.courseDescription"),e}(),n=function(){function e(e,t){switch(this.course=e,this.status=t,t){case s.a.Open:this.optionsForCurrentStatus=o.Open;break;case s.a.Complete:this.optionsForCurrentStatus=o.Complete;break;case s.a.Private:this.optionsForCurrentStatus=o.Private;break;case s.a.OpenTermClassic:this.optionsForCurrentStatus=o.OpenTermClassic;break;case s.a.PrivateTermClassic:this.optionsForCurrentStatus=o.PrivateTermClassic;break;case s.a.TermOpen:this.optionsForCurrentStatus=o.TermOpen;break;case s.a.TermComplete:this.optionsForCurrentStatus=o.TermComplete;break;case s.a.TermPrivate:this.optionsForCurrentStatus=o.TermPrivate;break;case s.a.OpenClassic:this.optionsForCurrentStatus=o.OpenClassic;break;default:throw new Error("Unknown CourseStatus")}}return e.prototype.getLocalizationKey=function(e){var t=this.course.isOrganization?"organization.outline":"course.outline";return(e||"").startsWith(".")?t+e:e},e.prototype.getStatus=function(){return this.status},e.prototype.getModalTitle=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.modalTitle)},e.prototype.getModalDismissText=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.modalDismissText)},e.prototype.getModalText=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.modalText)},e.prototype.getSecondaryButtonText=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.secondaryButtonText)},e.prototype.getPrimaryButtonText=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.primaryButtonText)},e.prototype.getSecondaryButtonStatus=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.secondaryButtonStatus)},e.prototype.getPrimaryButtonStatus=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.primaryButtonStatus)},e.prototype.getCourseStatusName=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.courseStatusName)},e.prototype.getCourseDescription=function(){return this.getLocalizationKey(this.optionsForCurrentStatus.courseDescription)},e}()},ptBS:function(e,t,r){var s=r("ziER"),i=r("5JeM"),o=new s({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(o);e.exports=o},"qG/h":function(e,t,r){"use strict";r.d(t,"c",(function(){return q})),r.d(t,"a",(function(){return W})),r.d(t,"b",(function(){return V}));var s=r("D57K"),i=r("nsO7"),o=r("5iHu"),n=r("wHJ2"),a=r("5MwF"),u=r("9zo4"),c=r("nbDY"),l=r.n(c),m=r("0JpG"),p=r("en1n"),h=r("Fvsw"),d=r("fYJU"),b=r("ZzN+"),f=r("go4a"),v=r("Sa5G"),y=r("0+Qs"),C=r("pjml"),T=r("emI2"),g=r("QIw5"),S=r("zdqs"),M=r("BjFu"),F=r("SoDU"),k=r("lEL+"),A=r("hkqm"),I=r("p7qr"),w=r("TnpK"),L=r("Ego9"),P=r("Q/M7"),x=r("1y/X"),O=r("yC9S"),$=r("z6Q5"),B=r("+brj"),E=r("aHpC"),_=r("GbAM"),z=r("H8CZ"),D=r("Qbdf"),U=r("k+3c"),j=r("ZQey"),N=r("/jNt"),R=r("s7x+"),H=r("S1rJ"),K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.FilterAll=new t("filter-all-courses"),t.FilterTeach=new t("filter-courses-i-teach"),t.FilterTake=new t("filter-courses-i-take"),t.FilterSupport=new t("filter-courses-i-support"),t.FilterOpen=new t("filter-open-courses"),t.FilterPrivate=new t("filter-private-courses"),t.FilterCompleted=new t("filter-completed-courses"),t.FilterExternal=new t("filter-external-courses"),t.FilterHidden=new t("filter-hidden-from-me"),t}(l.a),q="ultra.base.courses.controller",W=function(){function e(e,t,s,o,n,a,u,c,l,m,h,d,b,f,v,y,C,T,g,S,M,F,k,A,I,w,L){var P=this;this.$compile=e,this.browserStorage=t,this.$modal=s,this.$q=o,this.$rootScope=n,this.$scope=a,this.bbBatch=u,this.accessibility=c,this.context=l,this.interval=m,this.bbLocalize=h,this.CourseMembershipModel=d,this.TermModel=b,this.UserModel=f,this.CourseModel=v,this.TermService=y,this.timeout=C,this.toast=T,this.ultraState=g,this.courseFavoriteService=S,this.ScheduledTaskModel=M,this.ConversionService=F,this.ConversionTaskModel=k,this.AnalyticsEvent=A,this.contextUser=I,this.contextCourse=w,this.preferenceService=L,this.loadedFavorites=Object.create(null),this.courseCarouselReady=!1,this.courseCarousel=Object.create(null),this.visibleCourseFilters=[],this.toFocusTermSelector=!1,this.courseShowFocused=!1,this.showMagicMoment=!1,this.isLoading=!0,this.hasHiddenCourse=!1,this.ctrlTitles={},this.setToUltraCourses={},this.batchQueue=[],this.isLargeUpBreakpoints=p.f,this.showSearchInputInLargeDownBreakpoints=!1,this.isFavoriteFTUECreated=!1,this.getOverflowMenuItems=function(e){return[{uniqueId:"edit-course-image",icon:"draw",labelKey:P.ctrlTitles.editCourseImage,show:function(){return e.course.permissions.editBanner&&P.isMultiColumnCardView()},onClick:P.openEditBannerPanel.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".editBanner",params:{courseTitle:e.course.displayName},noWrap:!0})},additionalAttributes:{analyticsIdOverride:"base.courses.courseCard.editBanner.button"}},{uniqueId:"unlocked-classic",icon:"unlocked",labelKey:P.ctrlTitles.privateCourse,show:function(){return e.isActAsInstructorMembership()&&!e.course.isUndecided()&&P.isCourseConversionComplete(e.course)&&e.course.isOpen()&&e.course.isClassic()&&e.course.permissions.editAvailability},onClick:P.openCourseStatusUpdateModal.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".completeClassicCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}},{uniqueId:"unlocked-non-classic",icon:"unlocked",labelKey:P.ctrlTitles.completeOrPrivateCourse,show:function(){return e.isActAsInstructorMembership()&&!e.course.isUndecided()&&P.isCourseConversionComplete(e.course)&&e.course.isOpen()&&e.course.isOpenNonClassic()&&e.course.permissions.editAvailability},onClick:P.openCourseStatusUpdateModal.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".completeCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}},{icon:"lock",labelKey:P.ctrlTitles.openCourse,show:function(){return e.isActAsInstructorMembership()&&!e.course.isUndecided()&&P.isCourseConversionComplete(e.course)&&e.course.isPrivate()&&e.course.permissions.editAvailability},onClick:P.openCourseStatusUpdateModal.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".openCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}},{icon:"course-complete",labelKey:P.ctrlTitles.openOrPrivateCourse,show:function(){return e.isActAsInstructorMembership()&&!e.course.isUndecided()&&P.isCourseConversionComplete(e.course)&&e.course.isComplete()&&e.course.permissions.editAvailability},onClick:P.openCourseStatusUpdateModal.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".privateCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}},{icon:"visible",labelKey:P.ctrlTitles.hideCourse,show:function(){return!e.userHasHidden&&P.isCourseConversionComplete(e.course)},onClick:P.toggleCourseHideStatus.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".hideCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}},{icon:"invisible",labelKey:P.ctrlTitles.showCourse,show:function(){return e.userHasHidden},onClick:P.toggleCourseHideStatus.bind(P,e),ariaLabel:function(){return P.bbLocalize.translateSync({locale:e.course.getLocale()||P.bbLocalize.getAppLocale(),key:P.keyPrefix+".showCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}}]},this.activeFavoritePlaceHolder=0,this.isBaseOrganizations=g.includes("base.organizations.**"),this.keyPrefix=this.isBaseOrganizations?"base.organizations":"base.courses",this.fillFavoriteFTUE(),a.baseCourses=this,this.initializeAllFilters();var x=o.defer();a.firstSlideCreated=i.once((function(e){x.resolve()})),a.previewModalTitleKey=this.isBaseOrganizations?"organization.outline.previewCourse.modalTitle":"course.outline.previewCourse.modalTitle",this.$q.all([this.initializeData(),x.promise]).then((function(){P.setupCourseCarousel()&&(P.isLoading=!1,P.contextCourse.previewStatus&&P.contextCourse.previewStatus.previewing||P.displayStatusForCompleteConversions(),P.hasHiddenCourse=P.foundHiddenCourses(),Promise.all([r.e(7),r.e(10),r.e(20),r.e(1),r.e(2),r.e(12),r.e(19),r.e(14),r.e(23),r.e(540)]).then(function(){}.bind(null,r)).catch((function(){})))})),a.$on("add-external-course",(function(e,t){var r=P.TermService.parseMembershipFromExternalCourse(t);P.addCourseMembership(r,!0),P.showMagicMoment=!1})),a.$on("update-external-course",(function(e,t){var r=P.TermService.parseMembershipFromExternalCourse(t);P.updateCourseMembership(r,!0)})),a.$on("delete-external-course",(function(e,t){var r=P.TermService.parseMembershipFromExternalCourse(t);P.deleteCourseMembership(r,!0),P.showMagicMoment=P.hasNoCourse()})),a.$on("update-course-status",(function(e,t,r){var s=P._findCourseMembership(t,P.termsAndMemberships.memberships);if(P.mySelectedFilter.isCourseStatusFilter){var i=P.termsAndMemberships.memberships[s];P.cutCourseMembershipFrom(i.course.id,P.loadedTermsAndMemberships.membershipsByTermId[i.course.ui.term.id].memberships)}P.termsAndMemberships.memberships[s].course.setStatus(r),P.refreshFilters()})),a.$on("update-slick-refresh",(function(e){P.courseCarousel.slick("slickGoTo",P.slickCurrentIndex,!0)})),a.$watch("baseCourses.slickCurrentIndex",(function(e,t){P.slickIndexChanged(e,t)})),a.$on("showConversionTooltip",(function(e,t){P.termsAndMembershipsLoadedPromise.then((function(){P.accessibility.setFocusOverrideOnPanel("[data-course-id="+t+"]",".base");var e=P._findCourseMembership(t,P.termsAndMemberships.memberships);if(-1!==e){var r=P.termsAndMemberships.memberships[e];r.course.refreshConvertToUltraStatus().then((function(e){P.showConversionTooltip(e),P.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus)||P._resetConversionTaskInterval(r)}))}}))})),a.$on("reloadCourse",(function(e,t){P._reloadCourse(t)})),a.$on("reloadCourseSchedule",(function(e,t){P.reloadCourseSchedule(t)})),O.b.OnWindow("resize",(function(){return a.$evalAsync()}),a);var $;["showCourse","hideCourse","privateCourse","completeOrPrivateCourse","openCourse","openOrPrivateCourse","editCourseImage"].forEach(($=this.keyPrefix+".title",function(e){P.ctrlTitles[e]=P.bbLocalize.translateSync({locale:P.bbLocalize.getLocale(P.$scope),key:$+"."+e})}))}return Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e,this.setViewPreference()},enumerable:!0,configurable:!0}),e.prototype.search=function(e){this.freetypeSearchKeyword=e,this.changeFilter(this.mySelectedFilter)},e.prototype.fillFavoriteFTUE=function(){var e=this;z.a(o(".base-courses-container"),(function(t){if(!t.originalEvent||"base-courses-container-show-event-trigger"!==t.originalEvent.animationName)return!0;var r=o(t.target);e.$compile('<div bb-guidance-target class="favorite-guidance-target" component-key="course.favorite"></div>')(e.$scope.$new(!0),(function(e){r.append(e)})),e.$compile('<bb-guidance class="guidance-element-overlay course-favorite-guidance" component-key="course.favorite"><bb-translate>'+e.keyPrefix+".addCourseToFavorites</bb-translate></bb-guidance>")(e.$scope.$new(!0),(function(e){r.parents("bb-base-course-card > div").append(e)}))}))},e.prototype._resetConversionTaskInterval=function(e){var t=this,r=e.course;this.ConversionService.setCheckConversionInterval(r,(function(s,i){t.CourseModel.findCourseByCourseId(r.courseId,!1).then((function(i){r.ui.showConversionInProgress=!1,r.ui.convertToUltraTaskStatus=s,r.ultraStatus=i.ultraStatus,r.$pk=i.id,r.id=i.id,r.ui.courseColorClass=f.a(e),r.ui.courseBannerImage=e.getBannerImageFilename(),r.ui.courseBannerImageThumbnail=e.getBannerImageThumbnailFilename(),t.showConversionTooltip(r)}))}))},e.prototype.isMultiColumnCardView=function(){return"grid"===this.view},e.prototype.shouldRenderFavoriteButton=function(e){return!e.isGuestMembership()&&this.isCourseConversionComplete(e.course)},e.prototype.initializeData=function(){var e=this,t=this.$q.defer();return this.termsAndMembershipsLoadedPromise=t.promise,this.$q.all([this.TermService.reloadTermsAndMemberships(),this.getSelectedFilterFromBrowserStorage(),this.getViewPreference(),this.courseFavoriteService.fetchFavoriteCourseIds()]).then((function(r){var s=r[0],o=r[1],n=r[2];e.view=n,e.termsAndMemberships=s;var a=new F.a(e.TermModel,e.termsAndMemberships.terms);e.currentTerm=a.currentTerm,e.upcomingTerm=a.upcomingTerm;var u=new S.a(a);e.membershipMapper=u.getMembershipMapper(),e.refreshFilters();var c=o&&(i.find(e.allFilters,(function(e){return e.nature.isEqualTo(new K(o))}))||{}).nature;e.mySelectedFilter=e._findCourseFilter(c||K.FilterAll),e.loadedTermsAndMemberships=e.buildCourseMemberships(e.mySelectedFilter),e.clearUnavailableFavoriteCourses(e.termsAndMemberships),g.a.Failure.isEqualTo(e.ultraState.params.enrollmentMessage)?e.toast.show({messageKey:e.keyPrefix+".failToEnroll"}):g.a.Unavailable.isEqualTo(e.ultraState.params.enrollmentMessage)&&e.toast.show({messageKey:e.keyPrefix+".courseUnavailable"}),e.initTermSelector(),t.resolve()}))},e.prototype.invokeBatchQueue=function(){var e=this;this.bbBatch.performBatch((function(){e.batchQueue.forEach((function(e){return e()}))})),this.batchQueue=[]},e.prototype.patchData=function(e){var t,r=this;e.course.instructorsMembership.isPatched||(t=e.course.instructorsMembership.$resolve,e.course.instructorsMembership.$resolve=function(){for(var s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];return r.batchQueue.push((function(){t.apply(e.course.instructorsMembership,s).$allow([403])})),r.invokeBatchQueue(),e.course.instructorsMembership},e.course.instructorsMembership.isPatched=!0)},e.prototype.getSelectedFilterFromBrowserStorage=function(){return this.browserStorage.getFromStorage(e.LOCAL_STORAGE_KEY_SELECTED_Filter,B.a.LocalStorage)},e.prototype._reloadCourse=function(e){var t=this._findCourseMembership(e,this.termsAndMemberships.memberships);-1!==t&&this.termsAndMemberships.memberships[t].course.$fetch()},e.prototype.reloadCourseSchedule=function(e){var t=this._findCourseMembership(e,this.termsAndMemberships.memberships);-1!==t&&this.termsAndMemberships.memberships[t].course.schedule.$refresh({limit:1})},e.prototype.getTermName=function(e){switch(e.ui.type){case"current":return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".currentCourses"});case"upcoming":return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".upcomingCourses"});case"year":return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".yearTerm",params:{year:e.ui.year}});default:return e.name}},e.prototype.initializeAllFilters=function(){this.allFilters=[{index:0,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.all"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.all"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.all"}),nature:K.FilterAll,show:function(e){return!0},filter:function(e){return!0}},{index:1,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.teach"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.teach"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.teach"}),nature:K.FilterTeach,show:function(e){return e.isActAsInstructorMembership()},filter:function(e){return e.isActAsInstructorMembership()}},{index:2,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.take"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.take"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.take"}),nature:K.FilterTake,show:function(e){return e.isStudentMembership()},filter:function(e){return e.isStudentMembership()}},{index:3,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.support"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.support"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.support"}),nature:K.FilterSupport,show:function(e){return e.isInRoleBucket(x.a.SUPPORTING)},filter:function(e){return e.isInRoleBucket(x.a.SUPPORTING)}},{index:4,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.open"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.open"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.open"}),nature:K.FilterOpen,show:function(e){return!0},filter:function(e){return e.course.isOpen()},isCourseStatusFilter:!0},{index:5,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.private"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.private"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.private"}),nature:K.FilterPrivate,show:function(e){return e.isActAsInstructorMembership()},filter:function(e){return e.course.isPrivate()},isCourseStatusFilter:!0},{index:6,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.complete"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.complete"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.complete"}),nature:K.FilterCompleted,show:function(e){return!0},filter:function(e){return e.course.isComplete()},isCourseStatusFilter:!0},{index:7,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.external"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.external"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.external"}),nature:K.FilterExternal,show:function(e){if(a.a.features.externalCourse)return e.course.ui.isExternal},filter:function(e){if(a.a.features.externalCourse)return e.course.ui.isExternal}},{index:8,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.hidden"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.hidden"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.hidden"}),nature:K.FilterHidden,show:function(e){return e.userHasHidden},filter:function(e){return e.userHasHidden}}]},e.prototype._findCourseFilter=function(e){return this.allFilters.filter((function(t){return e.isEqualTo(t.nature)}))[0]},e.prototype.hasCoursesInTerm=function(e,t){return t.membershipsByTermId[e.id]&&t.membershipsByTermId[e.id].memberships&&t.membershipsByTermId[e.id].memberships.length>0},e.prototype.isCourseConversionComplete=function(e){var t=this.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus);return!e.ui.convertToUltraTaskStatus||"?"===e.ui.convertToUltraTaskStatus||t},e.prototype.filterCourseMemberships=function(e,t){return K.FilterHidden.isEqualTo(e.nature)?t.filter(e.filter):t.filter((function(e){return!e.userHasHidden})).filter(e.filter)},e.prototype.hasMultipleTerms=function(e){return this.termsAndMemberships.termsByTermId&&this.termsAndMemberships.termsByTermId[e]&&this.termsAndMemberships.termsByTermId[e].length>0},e.prototype.onFavorite=function(e,t,r){r?(e.ui.isFavorite=r,this.$scope.$broadcast("pin-a-course",e),this.courseFavoriteService.pin(e.course),this.addCourseMembershipToFavorites(e,t)):(this.$scope.$broadcast("unpin-a-course",e),this.courseFavoriteService.unpin(e.course),this.resetCourseMembershipToOriginalLocation(e,t))},e.prototype.addCourseMembershipToFavorites=function(e,t){var r,s=this.loadedFavorites[t.id].memberships;(s.find((function(t){return t.course.id===e.course.id}))||(s.push(e),this.loadedFavorites[t.id].memberships=i.sortBy(s,(function(e){return e.course.name}))),e.course.ui.term.id!==t.id&&this.loadedFavorites[e.course.ui.term.id]&&!this.loadedFavorites[e.course.ui.term.id].memberships.find((function(t){return t.course.id===e.course.id})))&&((r=this.loadedFavorites[e.course.ui.term.id].memberships).push(e),this.loadedFavorites[e.course.ui.term.id].memberships=i.sortBy(r,(function(e){return e.course.name})));e.course.term&&e.course.term.id!==t.id&&this.loadedFavorites[e.course.term.id]&&!this.loadedFavorites[e.course.term.id].memberships.find((function(t){return t.course.id===e.course.id}))&&((r=this.loadedFavorites[e.course.term.id].memberships).push(e),this.loadedFavorites[e.course.term.id].memberships=i.sortBy(r,(function(e){return e.course.name})))},e.prototype.removeCourseMembershipFromFavorites=function(e,t){var r=t.id,s=this.loadedFavorites[r].memberships,i=s.findIndex((function(t){return t.course.id===e.course.id}));if(i>=0&&(s.splice(i,1),this.loadedFavorites[r].memberships=s),e.course.ui.term.id!==t.id&&this.loadedFavorites[e.course.ui.term.id]){var o=this.loadedFavorites[e.course.ui.term.id].memberships;(n=this.loadedFavorites[e.course.ui.term.id].memberships.findIndex((function(t){return t.course.id===e.course.id})))>=0&&(o.splice(n,1),this.loadedFavorites[e.course.ui.term.id].memberships=o)}if(e.course.term&&e.course.term.id!==t.id&&this.loadedFavorites[e.course.term.id]){var n;o=this.loadedFavorites[e.course.term.id].memberships;(n=this.loadedFavorites[e.course.term.id].memberships.findIndex((function(t){return t.course.id===e.course.id})))>=0&&(o.splice(n,1),this.loadedFavorites[e.course.term.id].memberships=o)}},e.prototype.resetCourseMembershipToOriginalLocation=function(e,t){var r,s=this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships.find((function(t){return t.course.id===e.course.id}));(s&&(s.ui.isFavorite=!1,s.ui._score=void 0,s.ui._hidden=!1),e.course.ui.term.id!==t.id)&&((r=this.loadedTermsAndMemberships.membershipsByTermId[e.course.ui.term.id].memberships.find((function(t){return t.course.id===e.course.id})))&&(r.ui.isFavorite=!1,r.ui._score=void 0,r.ui._hidden=!1));e.course.term&&e.course.term.id!==t.id&&((r=this.loadedTermsAndMemberships.membershipsByTermId[e.course.term.id].memberships.find((function(t){return t.course.id===e.course.id})))&&(r.ui.isFavorite=!1,r.ui._score=void 0,r.ui._hidden=!1))},e.prototype.isFirstNonFavorite=function(t,r){var s=this.isFirstCourseMembershipInGroup(t,r);return i.isUndefined(t.ui.isNeedCreateFTUE)&&e.STRING_EMPTY!==s&&(this.isFavoriteFTUECreated?t.ui.isNeedCreateFTUE=!1:t.ui.isNeedCreateFTUE=this.isFavoriteFTUECreated=!0),t},e.prototype.isLastFavorite=function(e,t){return i.last(this.loadedFavorites[t.id].memberships)===e},e.prototype.isFirstCourseMembershipInGroup=function(t,r){var s=this,i=this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships,o=this.TermService.filterAssortedDatesCourseMemberships(i).filter((function(e){return s.myFilter(e)})),n=this.TermService.filterAssociatedWithTermCourseMemberships(i).filter((function(e){return s.myFilter(e)}));return t.ui._hidden||0!==o.findIndex((function(e){return e.course.id===t.course.id}))?t.ui._hidden||0!==n.filter((function(e){return!e.ui._hidden&&t.course.term&&e.course.term.id===t.course.term.id})).findIndex((function(e){return e.course.id===t.course.id}))?e.STRING_EMPTY:"REGULAR_TERM":"ASSORTED_DATES"},e.prototype.isCurrentTerm=function(e){return C.Nb.ConstantTermId.CurrentTerm.isEqualTo(e.id)},e.prototype.isUpcomingTerm=function(e){return C.Nb.ConstantTermId.UpcomingTerm.isEqualTo(e.id)},e.prototype.filterFavoriteCourses=function(t){var r=this,s=t.filter((function(e){return r.courseFavoriteService.isPinned(e.course)}));return s.forEach((function(t){t.ui.isFavorite=!0,t.ui._score=e.FAVORITE_SCORE})),s},e.prototype.clearUnavailableFavoriteCourses=function(t,r){var s=this.courseFavoriteService.favoriteCourseIds;if(s.length>e.MAX_FAVORITE_COURSES_LENGTH){var o=void 0;o=r?t.membershipsByTermId[r].memberships.map((function(e){return e.course.id})):t.memberships.map((function(e){return e.course.id}));var n=i.difference(s,o);this.courseFavoriteService.clear(n)}},e.prototype.resetFavoriteCourseStatus=function(e){var t=this;e.forEach((function(e){e.ui._hidden&&(e.ui._hidden=!1,e.ui.isFavorite&&!t.courseFavoriteService.isPinned(e.course)&&(e.ui.isFavorite=!1,e.ui._score=void 0),!e.ui.isFavorite&&e.ui._score&&(e.ui._score=void 0))}))},e.prototype.buildFavorites=function(e){var t=this;Object.keys(e.membershipsByTermId).forEach((function(r){var s=e.membershipsByTermId[r].memberships,o=t.filterFavoriteCourses(s);t.loadedFavorites[r]={memberships:i.sortBy(o,["ui._score","course.name"])}}))},e.prototype._partiallyBuildMemberships=function(e){var t=this,r={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};return Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((function(s){var o;o=t.isBaseOrganizations?t.TermService.getOrganizationMembershipsFromArray(t.termsAndMemberships.membershipsByTermId[s].memberships):t.TermService.getCourseMembershipsFromArray(t.termsAndMemberships.membershipsByTermId[s].memberships);var n=[];if(t.hasMultipleTerms(s)){o=i.sortBy(o,(function(e){return e.course.term?e.course.term.name:""})),t.termsAndMemberships.termsByTermId[s].forEach((function(r){var s=t.TermService.filterAssociatedWithTermCourseMembershipsByTerm(o,r);n.push.apply(n,i.sortBy(t.filterCourseMemberships(e,s),["ui._score","course.name"]))}));var a=t.TermService.filterAssortedDatesCourseMemberships(o);n.push.apply(n,i.sortBy(t.filterCourseMemberships(e,a),["ui._score","course.name"]))}else n=i.sortBy(t.filterCourseMemberships(e,o),["ui._score","course.name"]);t.resetFavoriteCourseStatus(n),t.filterFavoriteCourses(n).forEach((function(e){return e.ui._hidden=!0})),r.membershipsByTermId[s]={memberships:n}})),r},e.prototype.myFilter=function(e){return!(!0===e.ui._hidden)},e.prototype.updateTerms=function(e){var t=this,r=this.termsAndMemberships.terms,i=r.filter((function(e){return C.Nb.ConstantTermId.CurrentTerm.isEqualTo(e.id)||C.Nb.ConstantTermId.UpcomingTerm.isEqualTo(e.id)||t.hasCoursesInTerm(e,t.termsAndMemberships)}));r.splice.apply(r,Object(s.__spreadArrays)([0,r.length],i)),e.terms=r},e.prototype.buildCourseMemberships=function(e,t){var r=this._partiallyBuildMemberships(e);return this.buildFavorites(r),this.updateTerms(r),r},e.prototype.changeFilter=function(t){t&&(this.mySelectedFilter=t,this.browserStorage.saveToStorage(e.LOCAL_STORAGE_KEY_SELECTED_Filter,this.mySelectedFilter.nature,B.a.LocalStorage)),this.loadedTermsAndMemberships=this.buildCourseMemberships(this.wrapFilterWithKeyword(this.mySelectedFilter)),this.currentPage=0;var r=this.activeTerm?this.activeTerm:this.currentTerm;this.notifyScreenReaderForResults(r)},e.prototype.notifyScreenReaderForResults=function(e){var t=this,r="";r=this.mySelectedFilter&&e&&this.loadedTermsAndMemberships.membershipsByTermId[e.id]&&this.loadedTermsAndMemberships.membershipsByTermId[e.id].memberships.length?this.keyPrefix+".search.someResults":this.keyPrefix+".search.noResults",r=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:r,noWrap:!0,noEscape:!0}),this.timeout((function(){t.$rootScope.$broadcast(_.b,r)}),this.$scope,100)},e.prototype.wrapFilterWithKeyword=function(e){var t,r=this,i=e.filter,o=Object(s.__assign)(Object(s.__assign)({},e),{filter:function(e){return e.ui._score=void 0,i(e)}});if(this.freetypeSearchKeyword){var n=[(t=new RegExp("^.*"+r.freetypeSearchKeyword.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+".*$","i"),function(e){return t.test(e.course.displayName)||t.test(e.course.courseId)}),function(){var e=r.freetypeSearchKeyword.split(/\s+/).map((function(e){return new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i")}));return function(t){return e.some((function(e){return!!e.exec(t.course.displayName)}))||e.some((function(e){return!!e.exec(t.course.courseId)}))}}()],a=o.filter;o=Object(s.__assign)(Object(s.__assign)({},o),{filter:function(e){return a(e)&&(t=n.findIndex((function(t){return t(e)})),e.ui._score=t,t>=0);var t}})}return o},e.prototype.foundHiddenCourses=function(){return this.termsAndMemberships.memberships.some(this._findCourseFilter(K.FilterHidden).filter)},e.prototype.updateSlick=function(e){e&&(this.activeTerm=e),this.activeTerm||(this.activeTerm=this.currentTerm);var t=this.loadedTermsAndMemberships.terms.indexOf(this.activeTerm);t<0&&(this.activeTerm=this.currentTerm,t=this.loadedTermsAndMemberships.terms.indexOf(this.currentTerm)),this.slickCurrentIndex=t,this.courseCarousel.slick("slickGoTo",this.slickCurrentIndex,!0),this.notifyScreenReaderForResults(this.activeTerm)},e.prototype.slickIndexChanged=function(e,t){if(null!=e){var r=this.loadedTermsAndMemberships.terms;this.loadedTermsAndMemberships.terms.length;this.activeTerm=r[e],this.preActiveTerm=r[e-1],this.nextActiveTerm=r[e+1],i.isUndefined(t)||(this.toFocusTermSelector?(this.toFocusTermSelector=!1,n.element(".term-navigator .select-wrapper>button").focus()):t>e?n.element(".term-navigator > .sibling-term").first().focus():t<e&&n.element(".term-navigator > .sibling-term").last().focus()),this.notifyScreenReaderForResults(this.activeTerm)}},e.prototype.identifyActiveTerm=function(e){return(!e||e<0)&&(e=0),this.loadedTermsAndMemberships.terms[e]},e.prototype.setCourseShowFocused=function(e){this.courseShowFocused=e},e.prototype.addCourseMembership=function(e,t){var r=this.membershipMapper.adjustTerm(e,this.context.getServerTime());e.course.ui.term=r,this.termsAndMemberships.memberships.push(e),this.termsAndMemberships.membershipsByTermId[r.id]||(this.termsAndMemberships.membershipsByTermId[r.id]={memberships:[]});var o=this.termsAndMemberships.membershipsByTermId[r.id].memberships;o.push(e),o=i.sortBy(o,(function(e){return e.course.name})),this.termsAndMemberships.membershipsByTermId[r.id].memberships=o;var n=this.filterCourseMemberships(this.mySelectedFilter,[e]),a=this.slickCurrentIndex+1;if(n.length>0){var u=this.filterCourseMemberships(this.mySelectedFilter,o);if(this.loadedTermsAndMemberships.membershipsByTermId[r.id]&&this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships){var c=this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships.length;this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships=u.slice(0,c+1),this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships.indexOf(e)<0&&(this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships.splice(c,1),this.loadedTermsAndMemberships.membershipsByTermId[r.id].memberships.push(e))}else this.loadedTermsAndMemberships.membershipsByTermId[r.id]={memberships:Object(s.__spreadArrays)(u)};this.updateTerms(this.loadedTermsAndMemberships),a=this.loadedTermsAndMemberships.terms.indexOf(r)}t&&(this.refreshFilters(),this.updateSlick(this.identifyActiveTerm(a)))},e.prototype.updateCourseMembership=function(e,t){this.deleteCourseMembership(e,!1),this.addCourseMembership(e,t)},e.prototype.cutCourseMembershipFrom=function(e,t){var r=this._findCourseMembership(e,t);return r>=0?t.splice(r,1)[0]:null},e.prototype.cutCourseMembershipByCourse=function(e){this.cutCourseMembershipFrom(e.id,this.loadedTermsAndMemberships.membershipsByTermId[this.activeTerm.id].memberships),this.cutCourseMembershipFrom(e.id,this.loadedFavorites[this.activeTerm.id].memberships),e.ui.term.id!==this.activeTerm.id&&(this.cutCourseMembershipFrom(e.id,this.loadedTermsAndMemberships.membershipsByTermId[e.ui.term.id].memberships),this.cutCourseMembershipFrom(e.id,this.loadedFavorites[e.ui.term.id].memberships)),e.term&&e.term.id!==this.activeTerm.id&&(this.cutCourseMembershipFrom(e.id,this.loadedTermsAndMemberships.membershipsByTermId[e.term.id].memberships),this.cutCourseMembershipFrom(e.id,this.loadedFavorites[e.term.id].memberships))},e.prototype.deleteCourseMembership=function(e,t){var r=e.course.id;if(e=this.cutCourseMembershipFrom(r,this.termsAndMemberships.memberships)){var s=e.course.ui.term.id;this.cutCourseMembershipFrom(r,this.termsAndMemberships.membershipsByTermId[s].memberships);var i=this.loadedTermsAndMemberships.membershipsByTermId[s].memberships;this.cutCourseMembershipFrom(r,i);this.updateTerms(this.loadedTermsAndMemberships),this.hasHiddenCourse=this.foundHiddenCourses(),this.refreshFilters()}},e.prototype._findCourseMembership=function(e,t){for(var r=0;r<t.length;r++)if(t[r].course.id===e)return r;return-1},e.prototype.isFilterOptionVisible=function(e,t){for(var r=t.terms.length-1;r>=0;--r){var s=t.membershipsByTermId[t.terms[r].id];if(s&&s.memberships.some(e.show))return!0}return!1},e.prototype._afterHidden=function(e,t){this.cutCourseMembershipByCourse(t.course);var r=this.loadedTermsAndMemberships.membershipsByTermId[this.activeTerm.id].memberships;e&&0===r.length&&this.updateTerms(this.loadedTermsAndMemberships),this.hasHiddenCourse=this.foundHiddenCourses(),this.$scope.$root.$emit("membership-hidden-status-update",t),this.refreshFilters()},e.prototype.toggleCourseHideStatus=function(e,t){var r,s=this,i=e.course;if(i.ui.isExternal){var o=this.TermService.parseExternalCourseFromMembership(e);r=o.isHidden,o.isHidden=!r,o.$save(["isHidden"]).$then((function(t){e.userHasHidden=t.isHidden,s._afterHidden(!r,e)}))}else{var n=i.memberships.$new(e.id);r=e.userHasHidden,n.userHasHidden=!r,n.$save(["userHasHidden"]).$then((function(t){e.userHasHidden=t.userHasHidden,s._afterHidden(!r,e);var o={action:"click",analyticsId:"hideCourse",url:document.URL,context:{user:s.contextUser.userId,membership:n.id,originalStatus:r,currentStatus:t.userHasHidden},applicationId:a.a.telemetryAppId,course:{id:i.id,uuid:i.uuid,batchUid:i.batchUid,ultraStatus:i.ultraStatus}};s.AnalyticsEvent.$create(o)}))}t&&(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault())},e.prototype.setupCourseCarousel=function(){return this.courseCarousel.init(),!!this.courseCarousel[0].slick&&(this.updateSlick(this.currentTerm),this.courseCarousel.slick("slickGoTo",this.slickCurrentIndex,!0),this.courseCarouselReady=!0,this.showMagicMoment=this.hasNoCourse(),!0)},e.prototype.refreshFilters=function(){var e=this,t=this.allFilters.filter((function(t){return e.isFilterOptionVisible(t,e.termsAndMemberships)}));return(t.length!==this.visibleCourseFilters.length||t.some((function(t,r){return e.visibleCourseFilters[r]!==t})))&&(this.visibleCourseFilters=t),!!(this.mySelectedFilter&&this.visibleCourseFilters.indexOf(this.mySelectedFilter)<0)&&(this.changeFilter(this._findCourseFilter(K.FilterAll)),!0)},e.prototype.hasNoCourse=function(){var e=this;return Object.keys(this.termsAndMemberships.membershipsByTermId).every((function(t){return e.termsAndMemberships.membershipsByTermId[t].memberships.length<=0}))},e.prototype.isAllFilterSelected=function(){return!!this.mySelectedFilter&&K.FilterAll.isEqualTo(this.mySelectedFilter.nature)},e.prototype.openEditBannerPanel=function(e){var t=this.isBaseOrganizations?"organization":"course";this.ultraState.goPeekState(t+"-edit-banner",{id:e.course.id})},e.prototype.openCourseStatusUpdateModal=function(e,t){var r=this;t&&(t.stopImmediatePropagation(),t.preventDefault()),this.setCourseStatus(e.course),this.ConversionService.isPreview(e.course)?this.$modal.open({template:R,scope:this.$scope,resolve:{translations:[m.serviceName,function(e){return e.loadBundle("features/course/outline/course-outline")}]}}).result.then((function(t){t&&(r.setToUltraCourses[e.course.id]=!0,r.updateCourseStatusAndDisplayMemeberships(e,t),e.course.setUltraStatusDecided().then((function(){r.setToUltraCourses[e.course.id]=!1})))})):(this.$scope.currentAnalyticsId="base.courses.statusUpdateModal",this.$modal.open({template:H,scope:this.$scope,resolve:{translations:[m.serviceName,function(e){return e.loadBundle("features/course/outline/course-outline")}]}}).result.then((function(t){r.updateCourseStatusAndDisplayMemeberships(e,t)})))},e.prototype.isSetToUltraCourse=function(e){return!!this.setToUltraCourses[e.id]},e.prototype.updateCourseStatusAndDisplayMemeberships=function(e,t){var r=this;if(t){e.course.$snapshot();var s=e.course.getStatus();e.course.setStatus(t),e.course.$patch().$then((function(t){if(t){var i=t.getStatus();r.$scope.$emit("update-course-status",t.courseId),!s.isEqualTo(i)&&r.mySelectedFilter.isCourseStatusFilter&&r.cutCourseMembershipByCourse(e.course)}}))}},e.prototype.setCourseStatus=function(e){e.isOpen()&&e.isClassic()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new U.a(e,j.a.OpenTermClassic):e.isPrivate()&&e.isClassic()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new U.a(e,j.a.PrivateTermClassic):e.isOpen()&&e.isClassic()?this.$scope.currentCourseStatus=new U.a(e,j.a.OpenClassic):e.isOpen()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new U.a(e,j.a.TermOpen):e.isPrivate()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new U.a(e,j.a.TermPrivate):e.isOpen()?this.$scope.currentCourseStatus=new U.a(e,j.a.Open):e.isPrivate()?this.$scope.currentCourseStatus=new U.a(e,j.a.Private):e.isHonorTermAvailability?this.$scope.currentCourseStatus=new U.a(e,j.a.TermComplete):this.$scope.currentCourseStatus=new U.a(e,j.a.Complete)},e.prototype.openExternalCourseInNewWindow=function(e,t){return P.o(e.ui.externalUrl),t.preventDefault(),t.stopImmediatePropagation(),!1},e.prototype.handleCourseLinkClick=function(e,t){var r=this;if(!e.isAvailable&&e.canConvert())e.ui.isUpdatingConversionStatus=!0,this.CourseModel.findCourseByCourseId(e.courseId,!0).then((function(s){s.id!==e.id&&(r.updateRestoredCourse(e,s),e.id=s.id),e.ultraStatus=s.ultraStatus,e.refreshConvertToUltraStatus().then((function(){e.ui.isUpdatingConversionStatus=!1,r.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus)?(r.ConversionService.cancelConversionInterval(e),r.courseLinkClickWithoutConversion(e,t)):(r.showConversionTooltip(e),r.ConversionService.setCheckConversionIntervalIfNotExist(e))}))}));else{if(e.canAccess())return this.courseLinkClickWithoutConversion(e,t);e.ui.showStudentUnavailable=!0}},e.prototype.courseLinkClickWithoutConversion=function(e,t){if(e.ui.isExternal)return this.openExternalCourseInNewWindow(e,t);this.ultraState.goPeekState("course.outline",{courseId:e.id})},e.prototype._replaceCourseMembership=function(e,t,r){var s=this._findCourseMembership(e.course.id,r);s>=0&&(r[s]=t)},e.prototype.updateRestoredCourse=function(e,t){var r=this;this.contextUser.userModel.memberships.$fetch({organization:!1,limit:1e4,expand:"course.instructorsMembership,course.effectiveAvailability,course.permissions,courseRole"}).$asPromise().then((function(s){var o=i.find(s,(function(e){return e.course&&e.course.$pk===t.id}));if(o){o.course.ui=n.copy(e.ui),o.course.ui.courseColorClass=f.a(o);var a=r.TermService.getCourseMembership(e.id),u=a.course.ui.term.id;r._replaceCourseMembership(a,o,r.loadedTermsAndMemberships.membershipsByTermId[u].memberships),r._replaceCourseMembership(a,o,r.termsAndMemberships.membershipsByTermId[u].memberships),r._replaceCourseMembership(a,o,r.termsAndMemberships.memberships)}}))},e.prototype.batchEvaluateConversionStatus=function(e){var t=this,r=e.filter((function(e){return e.course.isUltraPreview()||e.course.isClassic()})).map((function(e){return{course:e.course}}));if(0!==r.length){var s=r.map((function(e){return{course:e.course}}));this.bbBatch.performBatch((function(){return t.$q.all(r.map((function(e){return e.course.conversions.$new("conversionStatus").$fetch().$allow([404,403]).$asPromise()})))})).then((function(r){r.forEach((function(r,i){var o=s[i].course;o.ui.convertToUltraTaskId=r.taskId,o.ui.convertToUltraTaskStatus=r.taskStatus?r.taskStatus.toString():void 0,o.ui.conversionTaskTitle=r.taskTitle,t.ConversionService.isConversionComplete(o.ui.convertToUltraTaskStatus)||(t._resetConversionTaskInterval(e[i]),t.showConversionTooltip(o))}))}))}},e.prototype.getAlertType=function(e){var t=v.i.None;return e.ui.showConversionInProgress?t=e.isOrganization?v.i.OrgConversionInProgress:v.i.ConversionInProgress:e.ui.showConversionComplete?t=e.isOrganization?v.i.OrgConversionComplete:v.i.ConversionComplete:e.ui.showStudentUnavailable&&(t=e.isAvailable?e.isOrganization?v.i.ParticipantNoLongerAccessible:v.i.StudentNoLongerAccessible:e.isOrganization?v.i.ParticipantTryAgain:v.i.StudentTryAgain),t},e.prototype.hideConversionStatus=function(e){e.ui.showConversionInProgress=!1,e.ui.showConversionComplete=!1,e.ui.showStudentUnavailable=!1},e.prototype.confirmConversionDialog=function(e){e.ui.showConversionComplete?this.goPeekState("course.outline",e):o("#course-link-"+e.id).focus(),this.hideConversionStatus(e)},e.prototype.goPeekState=function(e,t){this.ultraState.goPeekState(e,{courseId:t.id}),this.hideConversionStatus(t)},e.prototype.displayStatusForCompleteConversions=function(){this.batchEvaluateConversionStatus(this.filterCourseMemberships(this.mySelectedFilter,this.termsAndMemberships.memberships).filter((function(e){return!e.course.ui.isExternal&&e.course.canConvert()})))},e.prototype.isFocusedCourse=function(e){return o(document.activeElement).is(n.element(o("a#course-link-"+e)))},e.prototype.showConversionTooltip=function(e){var t=this.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus);this.changeTooltipStatus(t,e)},e.prototype.changeTooltipStatus=function(e,t){t.ui.showConversionComplete=e,t.ui.showConversionInProgress=!e},e.prototype.getInstructorUsers=function(e){e.ui=e.ui||{};var t=e.ui.cachedInstructors;return t&&e.instructorsMembership.length===e.ui.cachedInstructors.length||(t=e.instructorsMembership?e.instructorsMembership.map((function(e){return e.user})):[],e.ui.cachedInstructors=t),t},e.prototype.getCourseName=function(e){var t=e.course.displayName;if(this.isMultiColumnCardView()){var r=this.getCourseTitleElement(e.course.id);Object(I.a)(r)}return t},e.prototype.getCourseTitleElement=function(e){var t=o("#course-link-"+e+" .js-course-title-element");return t.length?t[0]:void 0},e.prototype.initTermSelector=function(){var e=this;this.availableTerms=this.loadedTermsAndMemberships.terms.map((function(t,r){var s=e.getTermName(t);return{index:r,name:s,nature:s,value:s}})),this.availableTerms.reverse(),this.mySelectedTerm=this.availableTerms[1]},e.prototype.changeTerm=function(e,t){void 0===t&&(t=!0),this.mySelectedTerm=e,this.toFocusTermSelector=t,this.courseCarousel.slick("slickGoTo",this.mySelectedTerm.index,t)},e.prototype.slideToPrevTerm=function(){var e=this.availableTerms[this.availableTerms.length-this.slickCurrentIndex];this.changeTerm(e,!1)},e.prototype.slideToNextTerm=function(){var e=this.availableTerms[this.availableTerms.length-this.slickCurrentIndex-2];this.changeTerm(e,!1)},e.prototype.onPageSizeChange=function(e){this.pageSize=e},e.prototype.onChangePage=function(e,t){this.activeFavoritePlaceHolder=0,n.element("#main-content-inner").animate({scrollTop:0},400,(function(){n.element(".course-element-card").eq(0).focus()}))},e.prototype.getCurrentPageFavoritesCount=function(e,t){if(void 0===t&&(t=this.currentPage),n.isUndefined(this.loadedFavorites[e.id]))return 0;var r=t*this.pageSize;return this.loadedFavorites[e.id].memberships.slice(r,r+this.pageSize).length},e.prototype.getLimit=function(e){if(Number.isNaN(Number(this.currentPage))||!this.loadedFavorites[e.id])return this.pageSize;var t=this.loadedFavorites[e.id].memberships.length;if(0===t)return this.pageSize;var r=Math.ceil(t/this.pageSize),s=this.getCurrentPageFavoritesCount(e);return this.currentPage+1<r?0:Math.abs(this.pageSize-s+this.activeFavoritePlaceHolder)},e.prototype.getLimitBegin=function(e){if(Number.isNaN(Number(this.currentPage))||n.isUndefined(this.loadedFavorites[e.id]))return 0;var t=this.currentPage*this.pageSize-this.loadedFavorites[e.id].memberships.length;return t>=0?t:0},e.prototype.toggleSearchInput=function(){this.showSearchInputInLargeDownBreakpoints=!this.showSearchInputInLargeDownBreakpoints,this.showSearchInputInLargeDownBreakpoints&&this.timeout((function(){n.element("#course-search-input").focus()}),this.$scope,100,!1)},e.prototype.shouldShowSearchInput=function(){return this.showSearchInputInLargeDownBreakpoints||this.isLargeUpBreakpoints()},e.prototype.getCatalogType=function(){return this.isBaseOrganizations?N.b:N.a},e.prototype.getViewPeferenceKey=function(){return this.isBaseOrganizations?"ultraui.courselist.view.organization":"ultraui.courselist.view.course"},e.prototype.getViewPreference=function(){return this.preferenceService.getPreference(this.getViewPeferenceKey(),"list").then((function(e){return i.get(e,"value")||"list"}))},e.prototype.setViewPreference=function(){if(!this.isLoading&&this._view)return this.preferenceService.setPreference(this.getViewPeferenceKey(),this.view)},e.LOCAL_STORAGE_KEY_SELECTED_Filter="LOCAL_STORAGE_KEY_SELECTED_Filter",e.MAX_FAVORITE_COURSES_LENGTH=100,e.FAVORITE_SCORE=-1e4,e.STRING_EMPTY="",e.$inject=["$compile",B.c,"$modal","$q","$rootScope","$scope",$.b,u.c,h.b,y.b,m.serviceName,C.v.serviceName,C.Nb.serviceName,C.Qb.serviceName,C.o.serviceName,M.b,k.b,A.b,w.d,L.b,C.sb.serviceName,b.b,C.n.serviceName,C.b.serviceName,d.b,D.e,T.c],Object(s.__decorate)([Object(E.a)(800)],e.prototype,"invokeBatchQueue",null),e}(),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(W)},"s7x+":function(e,t){e.exports='<bb-modal class="js-course-status-modal-PREVIEW notification" modal-title-key="{{previewModalTitleKey}}"\n          modal-dismiss-key=""\n          analytics-id-tag-prefix="course.outline.previewCourse">\n  <div name="modal-contents">\n    <p bb-translate="course.outline.previewCourse.modalText" course-org-token-resolver></p>\n  </div>\n  <button name="modal-footer-button-primary" \n          ng-click="$parent.$close(\'OPEN\')" \n          class="button js-course-status-OPEN js-primary-button"\n          analytics-id="course.outline.previewCourse.open.button">\n    <span bb-translate="course.outline.previewCourse.makeOpen" course-org-token-resolver></span>\n  </button>\n  <button name="modal-footer-button-secondary" \n          ng-click="$parent.$close()" \n          class="button button--secondary js-course-status- js-secondary-button"\n          analytics-id="course.outline.previewCourse.close.button">\n    <span bb-translate="global.cancel"></span>\n  </button>\n</bb-modal>'},zdqs:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("nsO7"),i=r("VdDF"),o=r("pjml"),n=function(){function e(e){this.termUtil=e,this.membershipTermMapper=new a(this.termUtil)}return e.prototype.getMembershipMapper=function(){return this.membershipTermMapper},e.prototype.map=function(e,t){var r=this;return e.map((function(e){return{membership:e,term:r.membershipTermMapper.adjustTerm(e,t)}}))},e}(),a=function(){function e(e){this.termUtil=e}return e.prototype.adjustTerm=function(e,t){var r=this.getCourseDateRange(e);return r.start>t?e.course.ui.term=this.termUtil.upcomingTerm:i.a.isWithinDateRange(t,r)?e.course.ui.term=this.termUtil.currentTerm:e.course.term?e.course.ui.term=e.course.term:e.course.ui.term=this.getTermMappingBasedOnCourseDates(e,r,t),e.course.ui.term},e.prototype.getCourseDateRange=function(e){var t,r;if(o.o.CourseDuration.DateRange.isEqualTo(e.course.durationType))t=e.course.startDate,r=e.course.endDate;else if(o.o.CourseDuration.FixedNumDays.isEqualTo(e.course.durationType))t=e.enrollmentDate,(r=new Date(e.enrollmentDate.getTime())).setDate(r.getDate()+e.course.numDaysOfUse);else if(o.o.CourseDuration.UseTerm.isEqualTo(e.course.durationType)){var s=e.course.term?this.termUtil.getTerm(e.course.term.id):null;s&&(o.Nb.TermDuration.DateRange.isEqualTo(s.durationType)?(t=s.startDate,r=s.endDate):o.Nb.TermDuration.FixedNumDays.isEqualTo(s.durationType)&&(t=e.enrollmentDate,(r=new Date(e.enrollmentDate.getTime())).setDate(r.getDate()+s.daysOfUse)))}return{end:r,start:t}},e.prototype.getTermMappingBasedOnCourseDates=function(e,t,r){var i=t.start||e.course.term&&e.course.term.startDate;if(!i){if(!(t.end&&r>t.end))return this.termUtil.currentTerm;i=t.end}var o=this.termUtil.filterTerm(i);if(0===o.length)return this.termUtil.createYearTerm(i);if(1===o.length)return o[0];if(o.length>1){var n=s.sortBy(o,["startDate","id"]);return n[n.length-1]}},e}()}}]);