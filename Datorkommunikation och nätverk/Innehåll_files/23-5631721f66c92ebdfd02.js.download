(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"3Bw1":function(e,t){e.exports='<bb-modal id="content-deleted-modal"\n          class="notification"\n          modal-title-key="base.stream.modal.deleted.title"\n          analytics-id-tag-prefix="base.stream.modal.deleted">\n  <div name="modal-contents">\n    <p bb-translate>base.stream.modal.deleted.body</p>\n  </div>\n  <button name="modal-footer-button-primary" class="button confirm-ok js-primary-button" ng-click="$parent.$close()" bb-translate analytics-id="global.ok">global.ok</button>\n</bb-modal>\n'},"7C3+":function(e,t,n){"use strict";n.d(t,"g",(function(){return T})),n.d(t,"h",(function(){return _})),n.d(t,"f",(function(){return v})),n.d(t,"e",(function(){return g})),n.d(t,"a",(function(){return S})),n.d(t,"d",(function(){return I})),n.d(t,"b",(function(){return D})),n.d(t,"c",(function(){return C}));var r=n("D57K"),o=n("nsO7"),i=n("wHJ2"),a=n("6ynb"),s=n("0JpG"),c=n("vhkR"),l=n("Is+C"),u=n("Fvsw"),d=n("KBr+"),p=n("P2dS"),f=n("12mu"),y=n("pjml"),h=n("8jzW"),m=n("KtUo"),b=n("r6lH"),E=n("av75"),T="ultra.service.stream.transformer.data",_="baseStreamEntryTransformer",v=function(){function e(){}return e.getCourseId=function(e){return e&&e.se_courseId||e&&e.se_orgId||""},e.getCourseName=function(e){return e&&e.ui.streamCourse&&e.ui.streamCourse.name||""},e.getSequenceId=function(e){return e.se_id.substr(e.providerId.length)},e.getEntryType=function(e){if(e){var t=e.extraAttribs&&e.extraAttribs.event_type||e.providerId;if(t&&t.length>0)return t.trim()}throw new Error("Type identifier does not exist on the given Learn stream entry."+(e.se_id||""))},e.generateStreamId=function(t){return t&&t.se_id||"local_"+e.index++},e.validateEntriesForGrouping=function(e,t){var n=e&&e.length>0;if(n){var r=e[0].courseId;n=e.every((function(e){return e.isGroupable&&t.some((function(t){return t===e.type}))&&e.courseId===r}))}return n},e.hasNewEntry=function(e){return e&&e.some((function(e){return e.isNew}))||!1},e.getMostRecentEntry=function(e){return e&&e.length>0?o.sortBy(e,"notificationCreationDate")[e.length-1]:null},e.getGroupedEntryIds=function(e){var t=[];return e&&Array.isArray(e)&&e.forEach((function(e){var n=e.groupedEntryIds;n?t=t.concat(n):t.push(e.id)})),t},e.getDistinctAuthorIds=function(e,t){var n={};return e.forEach((function(e){var r=e.authorIds;if(r)r.forEach((function(e){n[e]=n[e]||[]}));else{var o=t(e);(n[o]=n[o]||[]).push(e)}})),Object.keys(n)},e.getCoursePanelStateRef=function(e,t){return"course.outline("+i.toJson({courseId:e,legacyUrl:t})+")"},e.getDiscussionPanelStateRef=function(e,t){return'discussion.view.with-grading({ contentId: "'+e+'", courseId: "'+t+'" })'},e.getJournalPanelStateRef=function(e,t){return'journal.view.with-grading({ contentId: "'+e+'", courseId: "'+t+'" })'},e.DUE_DATE_FORMAT=s.ILocaleDatetimeFormat.Short,e.index=1,e}(),g=function(e){function t(t){var n=e.call(this,t)||this;return n.name="StreamEntriesGroupingError",n}return Object(r.__extends)(t,e),t}(a.a),S=function(){function e(e){this.supportedTypes=e}return e.prototype.canHandle=function(e){return e&&this.canHandleType(v.getEntryType(e))},e.prototype.canHandleType=function(e){return this.supportedTypes&&this.supportedTypes.some((function(t){return 0===t.indexOf(e)}))},e.prototype.convert=function(e){return{id:v.generateStreamId(e),type:v.getEntryType(e),providerId:e.providerId,eventType:e.itemSpecificData.eventType,notificationCreationDate:e.se_timestamp>0?new Date(e.se_timestamp):null,contextualDate:null,icon:null,isNew:!1,isImportant:!1,isGroupable:!1,courseId:v.getCourseId(e),isOrg:e&&e.ui.streamCourse&&e.ui.streamCourse.isOrganization||null,header:v.getCourseName(e),title:null,contentHandler:e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler}},e.prototype.setLegacyCourseUrlRefToBody=function(e,t){var n=e&&e.ui&&e.ui.streamCourse,r=e&&e.se_itemUri;n&&n.isClassic()&&r&&(t.body=t.body||{},t.body.stateRef=v.getCoursePanelStateRef(n.id,r))},e}(),I=function(e){function t(t,n){var r=e.call(this,n)||this;return r.bbLocalize=t,r}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);return n.entrySpecificData=t.ui.streamUser?{streamUser:t.ui.streamUser}:null,n},t.prototype.getUserDisplayName=function(e){return this.bbLocalize.formatUsername(e,s.ILocaleUsernameFormat.Short,null,{noWrap:!0,noEscape:!0})},t}(S),D=function(e){function t(){return e.call(this,[])||this}return Object(r.__extends)(t,e),t.prototype.canHandle=function(e){return!1},t.prototype.canHandleType=function(e){return!1},t.prototype.convert=function(n){var r=e.prototype.convert.call(this,n),o=n.itemSpecificData;return r.icon=t.DEFAULT_ICON,r.body={type:E.a.SimpleText,content:{bodyText:o.contentExtract||n.se_details||n.se_context}},r},t.DEFAULT_ICON="post",t}(S),C=function(e){function t(t,n){var r=e.call(this,m.b(t))||this;return r.supportedEventTypes=t,r}return Object(r.__extends)(t,e),t.prototype.canHandleType=function(e){if(!this.supportedEventTypes||!Object.keys(this.supportedEventTypes).length)return!1;var t=e.split(":")[0],n=this.supportedEventTypes[t];return n&&n.length>0&&n.some((function(t){return 0===t.indexOf(e)}))},t.prototype.convert=function(n){var r=e.prototype.convert.call(this,n),o=n.itemSpecificData.notificationDetails;return r.icon=t.TYPE_ICON_MAPPINGS[o.sourceType]||r.icon,r.notificationIds=o.notificationIds,r},t.TYPE_ICON_MAPPINGS={AS:"assignment",BL:"blog",CM:"message",CR:"course",DF:"discussion",DT:"discussion",JN:"journal",GB:"grades",QU:"course",SU:"survey",SC:"scormengine",TE:"test",UA:"assignment",WK:"wiki"},t}(S);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(D);i.module(T,[s.moduleName,c.b,l.b,u.a,d.a,f.a,y.R,h.b,b.a,p.a]).service(_,D)},"8iPc":function(e,t){e.exports='<p class="summary" ng-if="::bodyContent().bodyText" ng-bind-html="::bodyContent().bodyText"></p>\n<a class="button button--secondary action-button"\n   ng-if="::!bodyContent().isComponentActionSref"\n   bb-peek-sref="{{bodyContent().actionSref}}"\n   analytics-id="base.stream.entryBody.telemetry.link">{{::bodyContent().actionText}}</a>'},"KBr+":function(e,t,n){"use strict";var r=n("D57K"),o=n("wHJ2"),i=n("iYZE"),a=function(){function e(e,t,n,r){this.modelStatic=t,this.$q=n,this.$timeout=r,this.toFetch={},this.cache=new i(e)}return e.prototype.push=function(e,t){var n=this.cache.get(e);if(void 0!==n)return t(null,this.modelStatic.$buildRaw(n),e);var r=this.toFetch[e];null==r?this.toFetch[e]=[t]:r.push(t)},e.prototype.load=function(e){var t=this.$q.defer();return o.isArray(e)&&e.length>0||!o.isArray(e)?this._loadInternal(e,(function(e,n,r){e?t.reject(e):t.resolve(n)})):t.resolve({}),t.promise},e.prototype._loadInternal=function(e,t){if(Array.isArray(e))for(var n=this.getCoalescingCallback(e.length,t),r=0;r<e.length;r++)this.push(e[r],n);else this.push(e,t);this.lazyLoad()},e.prototype._load=function(){var e=this,t=this.toFetch;this.toFetch={};var n=Object.keys(t);0!==n.length&&this.modelStatic.findMany(n).$asPromise().then((function(r){var o,i={};if(Array.isArray(r))for(var a=0;a<r.length;a++)i[(o=r[a]).id]=o;else{if("object"!=typeof r)throw new Error("Invalid items format");i=r}for(var s=0;s<n.length;s++){var c=n[s];o=i[c];var l=t[c];e.cache.set(c,void 0===o?null:o.$encode());for(var u=0;u<l.length;u++)l[u](null,o,c)}}),(function(e){n.forEach((function(n){t[n].forEach((function(t){t(e)}))}))}))},e.prototype.lazyLoad=function(){var e=this;null==this.timeout&&(this.timeout=this.$timeout((function(){e._load(),e.timeout=null}),0,!1))},e.prototype.getCoalescingCallback=function(e,t){var n=!1,r={},o=0;return function(i,a,s){if(!n){if(i)return n=!0,t(i);a&&(r[s]=a),++o>=e&&(n=!0,t(null,r))}}},e}();o.module("ultra.utility.batchLoader",[]).factory("BatchLoaderFactory",["$q","$timeout",function(e,t){return function(n,r){return new a(n,r,e,t)}}]);var s=n("pjml");n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l}));var c="ultra.batchLoader.courseNameBatchLoader",l="CourseBatchLoader",u=function(){function e(e,t){this.batchLoader=e(200,t)}return e.prototype.load=function(e){return this.batchLoader.load(e)},e.$inject=["BatchLoaderFactory",s.o.serviceName],e}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(u);o.module(c,["ultra.utility.batchLoader",s.R]).service(l,u)},KtUo:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var r=function(e){return e.contextualDate||e.notificationCreationDate},o=function(e,t){var n=new Date(t.getTime());n.setHours(0,0,0,0);var r=new Date(n.getTime()+864e5);return e<n?-1:e>=r?1:0},i=function(e){return e&&Object.keys(e||{}).reduce((function(t,n){return t.concat(e[n])}),[])}},OaxL:function(e,t,n){"use strict";var r=n("D57K"),o=n("nsO7"),i=n("wHJ2"),a=n("5MwF"),s=n("Fvsw"),c=n("xpqL"),l=n("yC9S"),u=n("adx1"),d=n("aHpC"),p=n("MOka"),f=n("KtUo");var y=function(e){return e.filter((function(e){return e.isImportant}))};var h=function(e,t){return e.filter((function(e){var n=f.c(e);return!e.isImportant&&n&&f.a(n,t)<0}))};var m=function(e,t){return e.filter((function(e){var n=f.c(e);return!e.isImportant&&n&&0===f.a(n,t)}))};var b=function(e,t){return e.filter((function(e){var n=f.c(e);return!e.isImportant&&n&&f.a(n,t)>0}))},E=n("av75"),T=function(){function e(){this.allEntries=[],this.view=[]}return e.prototype.addEntries=function(e){this.allEntries=this.allEntries.concat(e)},e.prototype.refreshView=function(e){this.view=[].concat((e?e(this.allEntries):this.allEntries).filter((function(e){return!e.hidden})))},e.prototype.deleteEntries=function(e){this.allEntries=this.allEntries.filter((function(t){return-1===e.indexOf(t.id)}))},e}(),_=function(e){function t(t){var n=e.call(this)||this;return n.entryLoader=t,n}return Object(r.__extends)(t,e),t.prototype.addEntries=function(t){e.prototype.addEntries.call(this,y(t))},t.prototype.deleteEntry=function(e){if(e.isImportant){var t=this.allEntries.indexOf(e);t>=0&&(this.allEntries.splice(t,1),this.refreshView(this.entryLoader.viewFilter))}},t.prototype.refreshView=function(t){e.prototype.refreshView.call(this,t),this.entryLoader._updateBadgeCount()},t}(T),v=function(e){function t(t){var n=e.call(this)||this;return n.context=t,n.hasMoreInView=!1,n}return Object(r.__extends)(t,e),t.prototype.addEntries=function(t){e.prototype.addEntries.call(this,b(t,this.context.getServerTime())),this.allEntries=o.sortBy(this.allEntries,f.c)},t.prototype.refreshView=function(t){e.prototype.refreshView.call(this,t);var n=this.view.slice(P.UPCOMING_MAX_LENGTH,this.view.length);this.hasMoreInView=n.length>0&&n.some((function(e){return e.body&&e.body.type===E.a.DueDatedContent})),this.view=this.hasMoreInView?this.view.slice(0,P.UPCOMING_MAX_LENGTH):this.view},t}(T),g=function(e){function t(t,n,r){var o=e.call(this)||this;return o.context=t,o.entryLoader=n,o.streamSettings=r,o}return Object(r.__extends)(t,e),t.prototype.addEntries=function(t){var n=this;e.prototype.addEntries.call(this,m(t,this.context.getServerTime())),this.allEntries=this.entryLoader.groupStreamEntries(this.allEntries);var r=this.context.getServerTime(),i=this.allEntries.filter((function(e){return f.c(e)>=r})),a=this.allEntries.filter((function(e){return f.c(e)<r}));this.allEntries=o.sortBy(i,f.c).concat(o.sortBy(a,f.c).reverse()),this.allEntries.forEach((function(e){e.hidden=n.streamSettings.hidden(e)}))},t.prototype.deleteEntries=function(e){this.allEntries=this.allEntries.filter((function(t){var n=t;if(n.groupedEntryIds){n.groupedEntryIds=n.groupedEntryIds.filter((function(t){return-1===e.indexOf(t)}));var r=n;return r.entryContents&&(r.entryContents=r.entryContents.filter((function(t){return-1===e.indexOf(t.id)}))),n.groupedEntryIds.length>0}return-1===e.indexOf(t.id)}))},t}(T),S=function(e){function t(t,n){var r=e.call(this)||this;return r.context=t,r.entryLoader=n,r._currentViewFilter=null,r.queuedView=[],r}return Object(r.__extends)(t,e),t.prototype.addEntries=function(t){e.prototype.addEntries.call(this,h(t,this.context.getServerTime())),this.allEntries=o.sortBy(this.allEntries,f.c).reverse()},t.prototype.refreshView=function(e){this.queuedView=[].concat((e?e(this.allEntries):this.allEntries).filter((function(e){return!e.hidden}))),(e||null)!==this._currentViewFilter?(this.view=[],this.loadMoreEntriesIntoView(),this._currentViewFilter=e):this.view=this.queuedView.splice(0,this.view.length)},t.prototype.loadMoreEntriesIntoView=function(){if(this.queuedView.length>0){var e=this.queuedView.splice(0,this._numEntriesToLoad());Array.prototype.push.apply(this.view,e)}},t.prototype._numEntriesToLoad=function(){var e=this.entryLoader.countViewEntries();return e>=t.MAX_ENTRIES_TO_PROGRESSIVE_LOAD?t.MAX_ENTRIES_TO_PROGRESSIVE_LOAD:t.MAX_ENTRIES_TO_PROGRESSIVE_LOAD-e},Object.defineProperty(t.prototype,"MAX_ENTRIES_TO_PROGRESSIVE_LOAD",{get:function(){return t.MAX_ENTRIES_TO_PROGRESSIVE_LOAD},enumerable:!0,configurable:!0}),t.MAX_ENTRIES_TO_PROGRESSIVE_LOAD=20,t}(T),I=n("Qbdf");n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return C})),n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return P}));var D="ultra.service.stream.loader",C="streamEntryLoader",R=0,O="PullingTaskScheduled",P=function(e){function t(t,n,r,i,a,s,c,u){var d=e.call(this)||this;return d.$interval=t,d.$log=n,d.$q=r,d.$rootScope=i,d.context=a,d.streamEntryManager=s,d.streamSettings=c,d.currentCourse=u,d.badgeCount=0,d.loadingErrorCount=0,d.buckets={},d.preLoading=!0,d.loadingStreamEntriesInProgress=!1,d.oneLoadingIsQueued=!1,d.buckets={important:new _(d),upcoming:new v(a),today:new g(a,d,c),previous:new S(a,d)},l.b.OnRootScope(d.$rootScope,"stream-entry-parent-item-not-found",(function(e,t){d.deleteEntries([t.id]),d.refreshEntries(!0)})),l.b.OnRootScope(d.$rootScope,"stream-settings-updated",(function(){d.reapplySettings()})),d.currentCourse.isInIframeOfPreviewMode()||d.init(),l.b.OnRootScope(d.$rootScope,"update-course-status",(function(e,t){var n=[];o.forEach(d.buckets,(function(e){o.forEach(e.allEntries,(function(e){e.courseId&&e.courseId===t&&!e.isOrg&&n.push(e.id)}))})),d.deleteEntries(n),d.refreshEntries(!0)})),l.b.OnRootScope(d.$rootScope,"update-course-name",(function(e,t){o.forEach(d.buckets,(function(e){o.forEach(e.allEntries,(function(e){e.courseId&&e.courseId===t.id&&!e.isOrg&&(e.header=t.displayName)}))}))})),d}return Object(r.__extends)(t,e),t.prototype.init=function(){var e=this;this.initialLoading=this.streamSettings.initializeSettings().finally((function(){e.preLoading=!1;try{return e.schedulePullingTask()}finally{e.currentTask.run()}})),this.streamEntryManager.$onStreamPulled((function(t,n){e._queueStreamData(n)}))},t.prototype.schedulePullingTask=function(e){var t=this;if(void 0===e&&(e=!1),this.currentTask&&!e)return this.currentTask.promise;this.$log.debug("Stream Polling Task Scheduled",(new Date).toISOString());var n=this.$q.defer(),r=this.$q.defer(),i=this.currentTask={id:R++,run:o.once((function(){window.requestAnimationFrame((function(){t.$log.debug("Stream Polling Task Running",(new Date).toISOString()),t._loadEntries(e).finally((function(){n.resolve(!0),i.run=o.once((function(){return r.resolve()}));var e=t.$interval(o.noop,a.a.streamLoadingInterval,1,!1);return t.$q.race([r.promise,e]).then((function(){t.$interval.cancel(e)}))})).then((function(){t.currentTask=null,t.schedulePullingTask()}))}))})),promise:n.promise};return this.$emitEvent(O,this.currentTask),n.promise},t.prototype._loadEntries=function(e){var t=this;return this.loadingStreamEntriesInProgress?this.oneLoadingIsQueued?null:(this.oneLoadingIsQueued=!0,this.loadEntriesPromise.then((function(){return t.oneLoadingIsQueued=!1,t._loadEntries(e)}))):(this.loadingStreamEntriesInProgress=!0,this.loadEntriesPromise=this.streamEntryManager.loadAllStreamEntries((function(){}),e).then((function(){t.loadingErrorCount=0}),(function(){t.loadingErrorCount++,t.loadingErrorCount>=A.MAX_LOADING_ERRORS&&t.cancelPeriodicLoading()})).finally((function(){t.loadingStreamEntriesInProgress=!1})),this.loadEntriesPromise)},t.prototype.refreshEntries=function(e){return this.schedulePullingTask(e)},t.prototype.cancelPeriodicLoading=function(){this.$log.error("Stream loading errors")},t.prototype.reapplySettings=function(){var e=this;this.getAllEntries().then((function(t){t.forEach((function(t){t.hidden=e.streamSettings.hidden(t)})),e._refreshViews()}))},t.prototype.isStreamLoading=function(){return this.loadingStreamEntriesInProgress||this.preLoading},t.prototype.groupStreamEntries=function(e){var n=this;if(e&&e.length>0){var r={};e.forEach((function(e){var n=e.type+t.ENTRY_GROUPING_KEY_DELIMITER+e.courseId;(r[n]=r[n]||[]).push(e)}));var o=[];return Object.keys(r).forEach((function(e){var i=r[e];if(1!==i.length&&i[0].isGroupable){var a=e.split(t.ENTRY_GROUPING_KEY_DELIMITER)[0];i=n.streamEntryManager.processGroupStreamEntry(i,a),o=o.concat(i)}else o=o.concat(i)})),o}return e},t.prototype.bulkUpdateEntryStatus=function(e){var t=this;e.forEach((function(e){i.isUndefined(e.hidden)&&(e.hidden=t.streamSettings.hidden(e))}))},t.prototype._queueStreamData=function(e){this._populateEntries(e.entries),this._deleteEntries(e.deletedIds,!1)},t.prototype._populateEntries=function(e){this.bulkUpdateEntryStatus(e),this.addEntries(e,!1)},t.prototype.deleteEntries=function(e){this._deleteEntries(e,!1)},t.prototype._deleteEntries=function(e,t){e&&e.length>0&&(this.allBuckets().forEach((function(t){return t.deleteEntries(e)})),t||this._refreshViews())},t.prototype.addEntries=function(e,t){e&&e.length>0&&(this.allBuckets().forEach((function(t){return t.addEntries(e)})),t||this._refreshViews())},t.prototype.removeImportantEntry=function(e){this.buckets.important.deleteEntry(e)},t.prototype._refreshViews=function(){var e=this;this.allBuckets().forEach((function(t){return t.refreshView(e.viewFilter)}))},t.prototype._updateBadgeCount=function(){this.badgeCount=this.buckets.important.view.length},t.prototype.allBuckets=function(){var e=this;return Object.keys(this.buckets).reduce((function(t,n){return t.push(e.buckets[n]),t}),[])},t.prototype._countAllEntries=function(){return this.allBuckets().reduce((function(e,t){return e+t.allEntries.length}),0)},t.prototype.findEntry=function(e){return this.getAllEntries().then((function(t){return o.find(t,{id:e})}))},t.prototype.getAllEntries=function(){var e=this;return this.currentCourse.isInIframeOfPreviewMode()?this.$q.when([]):this.initialLoading.then((function(){return e._getAllEntries()}))},t.prototype._getAllEntries=function(){var e=this;return Object.keys(this.buckets).reduce((function(t,n){return t.concat(e.buckets[n].allEntries)}),[])},t.prototype.countViewEntries=function(){return this.allBuckets().reduce((function(e,t){return e+t.view.length}),0)},t.prototype.setViewFilter=function(e){this.viewFilter=e,this._refreshViews()},t.prototype._reset=function(){this.allBuckets().forEach((function(e){e.allEntries=[]})),this._refreshViews()},t.ENTRY_GROUPING_KEY_DELIMITER="##",t.UPCOMING_MAX_LENGTH=5,t.MAX_LOADING_ERRORS=3,t=Object(r.__decorate)([Object(r.__param)(0,Object(d.b)("$interval")),Object(r.__param)(1,Object(d.b)("$log")),Object(r.__param)(2,Object(d.b)("$q")),Object(r.__param)(3,Object(d.b)("$rootScope")),Object(r.__param)(4,Object(d.b)(s.b)),Object(r.__param)(5,Object(d.b)(c.b)),Object(r.__param)(6,Object(d.b)(p.b)),Object(r.__param)(7,Object(d.b)(I.e))],t)}(u.a),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(P);i.module(D,[s.a,c.a]).service(C,P)},Oy15:function(e,t){e.exports='<span class="due-date" ng-switch on="bodyContent().localizedDueDate != null">\n  <bb-translate ng-switch-when="true" translate-values="{ datetime: \'{{bodyContent().localizedDueDate}}\' }">base.stream.entryBody.duedatedContent.dueDate</bb-translate>\n  <bb-translate ng-switch-when="false">base.stream.entryBody.duedatedContent.noDueDate</bb-translate>\n</span>\n\n'},ZNC7:function(e,t,n){"use strict";var r=n("D57K"),o=n("nbDY"),i=function(e){function t(t,n){var r=e.call(this,t)||this;return r.cssClassObj=n,r}return Object(r.__extends)(t,e),t.prototype.getCSSClass=function(){return this.cssClassObj.cssClass},t.prototype.getFirstCSSClass=function(){return this.cssClassObj.firstCssClass},t.BoxNotification=new t("BOX_NOTIFICATION",{cssClass:"notification-box",firstCssClass:"first-of-box"}),t.DefaultNotification=new t("DEFAULT_NOTIFICATION",{cssClass:"notification-default"}),t}(n.n(o).a);t.a=i},av75:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n("D57K"),o=n("nbDY"),i=n.n(o),a=n("u2fd"),s=n("Oy15"),c=n("gFY1"),l=n("sbY4"),u=n("8iPc"),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.templateObj=n,r}return Object(r.__extends)(t,e),t.prototype.getTemplateHtml=function(){return this.templateObj.template},t.SimpleText=new t("SIMPLE_TEXT",{template:a}),t.DueDatedContent=new t("DUE_DATED_CONTENT",{template:s}),t.Calendar=new t("CALENDAR",{template:c}),t.Grades=new t("GRADES",{template:l}),t.Telemetry=new t("TELEMETRY",{template:u}),t}(i.a)},gFY1:function(e,t){e.exports='<p class="summary">{{bodyContent().eventDescription}}</p>\n<bb-translate ng-if="!(bodyContent().isAllDayEvent)" translate-values="{ datetime: \'{{bodyContent().localizedEventDate}}\' }">base.stream.entryBody.calendar.eventDate</bb-translate>\n<bb-translate ng-if="bodyContent().isAllDayEvent" translate-values="{ date: \'{{bodyContent().localizedEventDate}}\' }">base.stream.entryBody.calendar.allDayEventDate</bb-translate>\n'},iG2q:function(e,t,n){"use strict";var r=n("D57K"),o=n("nsO7"),i=n("wHJ2"),a=n("nbDY"),s=n.n(a),c=n("7C3+"),l=n("/C4M"),u=n("Fvsw"),d=n("pjml"),p=n("0JpG"),f=n("f4B+"),y=n("g66W"),h=n("av75"),m="announcementStreamEntryTransformer",b=function(e){function t(n,r,o,i){var a=e.call(this,t.SUPPORTED_EVENT_TYPES)||this;return a.bbLocalize=n,a.context=r,a.CourseModel=o,a.remove=function(){var e=this;return i.all(this.notificationIds.map((function(t){return o.$new(e.courseId).notifications.$new(t).$destroy().$allow([404]).$asPromise()})))},a}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);return n.icon="announcement",n.isGroupable=!1,n.isImportant=!1,n.remove=this.remove,this.processDetails(n,t),n},t.prototype.processDetails=function(e,t){var n=this,r=t.itemSpecificData.notificationDetails,o="SYSTEM"===r.announcementType;o&&this.context.getBrand().$then((function(t){e.header=n.bbLocalize.translateSync({locale:null,key:"base.stream.institution",params:{brand:t.bannerText}})})),e.title=f.a.HTML(r.announcementTitle),e.body={type:h.a.SimpleText,content:{bodyText:y.c(r.contentExtract),fullText:y.d(r.announcementBody)}},o?e.body.stateRef='announcement({streamEntryId:"'+e.id+'"})':t.ui&&t.ui.streamCourse&&t.ui.streamCourse.isUltra()?(e.body.stateRef="announcement-detail("+i.toJson({courseId:r.courseId,announcementId:r.sourceId,mode:l.PanelModeEnum.VIEW,courseName:e.header})+")",e.notificationIds=r.notificationIds,e.body.content.sourceId=r.sourceId):this.setLegacyCourseUrlRefToBody(t,e)},t.SUPPORTED_EVENT_TYPES=["AN:AN_AVAIL","AN_AVAIL"],t.$inject=[p.serviceName,u.b,d.o.serviceName,"$q"],t}(c.a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(b);i.module(c.g).service(m,b);var E=function(e){function t(n){var r=e.call(this,t.SUPPORTED_PROVIDERS)||this;return r.bbLocalize=n,r}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);return n.icon="calendar",this.processDetails(n,t.itemSpecificData.calendarDetails),n},t.prototype.processDetails=function(e,t){switch(d.h.KnownCalendar.parse(t.calendarId)){case d.h.KnownCalendar.INSTITUTION:e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.calendar.institution"});break;case d.h.KnownCalendar.PERSONAL:e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.calendar.personal"})}e.title=this._getTitle(t.title);var n=new Date(t.startDate),r=!1;if(t.endDate){var o=new Date(t.endDate);r=0===n.getHours()&&0===n.getMinutes()&&23===o.getHours()&&59===o.getMinutes()}e.contextualDate=n;var i={eventDescription:t.description,localizedEventDate:r?this.bbLocalize.formatDateSync(n,p.ILocaleDateFormat.Short):this.bbLocalize.formatDatetimeSync(n,p.ILocaleDatetimeFormat.Short),eventStartDate:n,isAllDayEvent:r};e.body={type:h.a.Calendar,content:i};var a=t.canEdit?"event-edit":"event-view";e.body.stateRef=[a,"({",'calendarId: "',t.calendarId,'",','itemSourceType: "',t.itemSourceType,'",','itemSourceId: "',t.itemSourceId,'"',"})"].join("")},t.prototype._getTitle=function(e){return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.calendar.event",params:{entryTitle:e}})},t.SUPPORTED_PROVIDERS=["bb_calendar"],t.$inject=[p.serviceName],t}(c.a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(E);angular.module(c.g).service("calendarStreamEntryTransformer",E);var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t.Blog=new t("blog"),t.Journal=new t("journal"),t.Wiki=new t("wiki"),t}(s.a),_=function(e){function t(t,n){var r=e.call(this,t)||this;return r.learnEntryType=t,r.resourceKey=n,r}return Object(r.__extends)(t,e),t.EntryPosted=new t("EP","entryPosted"),t.EntryEdited=new t("EE","entryEdited"),t.EntryDeleted=new t("ED","entryDeleted"),t.CommentPosted=new t("CP","commentPosted"),t.CommentDeleted=new t("CD","commentDeleted"),t}(s.a),v=function(e){function t(n){return e.call(this,n,t.SUPPORTED_PROVIDERS)||this}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);n.isGroupable=!0,n.hasParticipated=t.se_participated,n.collabAuthorUser=t.ui.streamUser;var r=t.itemSpecificData.blogDetails,o=t.itemSpecificData.wikiDetails,i=r||o;r?(n.collabType=r.isJournal?T.Journal:T.Blog,n.collabId=r.coreIdContainer,n.collabTitle=r.blogName,r.isJournal?n.eventType="JR_".concat(n.eventType):n.eventType="BL_".concat(n.eventType)):o&&(n.collabType=T.Wiki,n.collabId=o.coreIdContainer,n.collabTitle=o.wikiName),this.processDetails(n,i),this.setLegacyCourseUrlRefToBody(t,n);var a=i.others;if(a&&a.length>0){var s=n;return n.collabAuthorUser?s.authorIds=a.concat([n.collabAuthorUser.id]):s.authorIds=a,s.groupedEntryIds=[n.id],this._setGroupedEntryTitle(s,n,s.authorIds.length),s}return this._setEntryTitle(n),n},t.prototype.processDetails=function(e,t){e.collabEventType=_.parse(t.eventType),e.collabEntryId=t.coreId,e.collabEntryTitle=t.title,e.icon=e.collabType.toString(),e.body={type:h.a.SimpleText,content:{bodyText:this._getBodyText(t)}}},t.prototype._setEntryTitle=function(e){var t=this,n=e.collabEventType.resourceKey;n||(e.title=e.collabEntryTitle);var r=this.getTitle(e),o=["base.stream.entryTitle",e.collabType,n];e.collabAuthorUser?this.getUserDisplayName(e.collabAuthorUser).then((function(n){o.push("withName"),e.title=t.bbLocalize.translateSync({locale:null,key:o.join("."),params:{entryTitle:r,userName:n}})})):(o.push("noName"),e.title=this.bbLocalize.translateSync({locale:null,key:o.join("."),params:{entryTitle:r,userName:null}}))},t.prototype.getTitle=function(e){return this._isCommentEventType(e.collabEventType)?e.collabEntryTitle:e.collabTitle},t.prototype._getBodyText=function(e){return this._isCommentEventType(e.eventType)?e.contentExtract:e.contentExtract?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.withHeader",noEscape:!0,params:{header:e.title,body:e.contentExtract}}):e.title},t.prototype._isCommentEventType=function(e){return _.CommentPosted.isEqualTo(e)||_.CommentDeleted.isEqualTo(e)},t.prototype.group=function(e){var n=this,r=c.f;if(!r.validateEntriesForGrouping(e,t.SUPPORTED_PROVIDERS))throw new c.e({message:"Could not group stream entries"});var o=[],i={};return e.forEach((function(e){var r=n._isCommentEventType(e.collabEventType),a=r?e.collabEntryId:e.collabId;if(!a&&r&&T.Wiki.isEqualTo(e.collabType)&&(a=e.collabEntryTitle),a){var s=[e.collabType,e.collabEventType,a].join(t.ENTRY_GROUPING_KEY_DELIMITER);(i[s]=i[s]||[]).push(e)}else o.push(e)})),Object.keys(i).forEach((function(e){var t=i[e];if(t.length>1){var a=r.getMostRecentEntry(t),s=n.distinctAuthorIds(t),c=a.courseId,l=r.getGroupedEntryIds(t),u={id:n.generateGroupedEntryId(c,e),groupedEntryIds:l,collabType:a.collabType,collabEventType:a.collabEventType,collabId:a.collabId,collabEntryId:a.collabEntryId,collabTitle:a.collabTitle,collabEntryTitle:a.collabEntryTitle,collabAuthorUser:a.collabAuthorUser,authorIds:s,entrySpecificData:a.entrySpecificData,type:a.type,providerId:a.providerId,eventType:a.eventType,notificationCreationDate:a.notificationCreationDate,icon:a.icon,isNew:r.hasNewEntry(t),isImportant:!1,isGroupable:!0,hasParticipated:t.some((function(e){return e.hasParticipated})),courseId:c,isOrg:a.isOrg,header:a.header,headerSubtitle:a.headerSubtitle,title:null,body:a.body};n._setGroupedEntryTitle(u,a,s.length),o.push(u)}else o=o.concat(t)})),o},t.prototype._setGroupedEntryTitle=function(e,t,n){var r=this,i=this.getTitle(t),a=["base.stream.groupedEntries",t.collabType,t.collabEventType.resourceKey];if(t.collabAuthorUser)this.getUserDisplayName(t.collabAuthorUser).then((function(t){var s=n-1,c=s>0?"plural":"";a.push("withName",c),e.title=r.bbLocalize.translateSync({locale:null,key:o.compact(a).join("."),params:{entryTitle:i,userName:t,numUsers:s}})}));else{var s=n,c=s>0?"plural":"";a.push("noName",c),e.title=this.bbLocalize.translateSync({locale:null,key:o.compact(a).join("."),params:{entryTitle:i,userName:null,numUsers:s}})}},t.prototype.generateGroupedEntryId=function(e,n){return["collabGroupEntry",e,n].join(t.ENTRY_GROUPING_KEY_DELIMITER)},t.prototype.distinctAuthorIds=function(e){return c.f.getDistinctAuthorIds(e,(function(e){var t=e;return t.collabAuthorUser&&t.collabAuthorUser.id||"unknown"}))},t.SUPPORTED_PROVIDERS=["bb_blog","bb_Wiki"],t.ENTRY_GROUPING_KEY_DELIMITER="##",t.$inject=[p.serviceName],t}(c.d);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(v);i.module(c.g).service("collabStreamEntryTransformer",v);var g=n("vhkR"),S=n("Is+C"),I=n("4nF1"),D=n("TnpK"),C=n("tdYh"),R=n("Q/M7"),O=n("3Bw1"),P=n("SeO5"),A=function(e){function t(n,r,o,i,a,s,c,l){var u=e.call(this,{CO:[t.TYPE]},l)||this;return u.bbLocalize=n,u.CourseModel=r,u.ltiService=o,u.scormService=i,u.ultraState=a,u.$modal=s,u.$rootScope=c,u._GROUPED_ENTRY_TITLE="base.stream.groupedEntries.courseContent.title",u.SUPPORTED_GROUP_PEEK_TYPES=[d.r.ContentHandler.ExternalLink,d.r.ContentHandler.File,d.r.ContentHandler.LtiPlacement,d.r.ContentHandler.LtiLink,d.r.ContentHandler.PartnerCloud],u}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);return n.isGroupable=!0,n.icon="",n.streamCourse=t.ui.streamCourse,this.processDetails(n,t.itemSpecificData),this.setLegacyCourseUrlRefToBody(t,n),n},t.prototype.processDetails=function(e,t){var n=this,r=t.notificationDetails,o=t.contentDetails;e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.avail",params:{entryTitle:r.title}}),e.body={type:h.a.SimpleText,content:{bodyText:e.streamCourse.isUltra()?f.a.HTML(r.contentExtract||""):r.contentExtract}};var i,a=I.a.normalize(o&&o.contentHandler);switch(i=d.r.ContentHandler.parse(a),e.entrySpecificData={contentItem:{id:r.courseContentId,courseId:e.courseId,contentHandler:i,title:r.title}},i){case d.r.ContentHandler.Discussion:e.body.stateRef=c.f.getDiscussionPanelStateRef(r.courseContentId,e.courseId);break;case d.r.ContentHandler.ExternalLink:var s=o.contentSpecificExtraData;s&&(s=C.a.test(s)?s:"http://"+s,e.body.externalRef={target:"_blank",href:s});break;case d.r.ContentHandler.LtiPlacement:case d.r.ContentHandler.LtiLink:case d.r.ContentHandler.PartnerCloud:e.body.clickHandler=function(){n.ltiService.ltiLaunch({courseId:e.courseId,contentId:r.courseContentId,showPreLaunchPanel:!0})};break;case d.r.ContentHandler.RusticiScorm:e.body.clickHandler=function(){n.scormService.scormLaunch({courseId:e.courseId,contentId:r.courseContentId,showPreLaunchPanel:!0})};break;case d.r.ContentHandler.File:var l=o.contentSpecificExtraData;l&&(e.entrySpecificData.contentItem.contentDetail={},e.entrySpecificData.contentItem.contentDetail[d.r.ContentHandler.File.toString()]={file:{mimeType:l}});var u=o.contentSpecificFileData;u&&(e.body.externalRef={target:"_blank",href:R.c(u)});break;case d.r.ContentHandler.Folder:e.entrySpecificData.contentItem.contentDetail={};var p=t.contentDetails&&t.contentDetails.isBbPage;e.entrySpecificData.contentItem.contentDetail[d.r.ContentHandler.Folder.toString()]={isBbPage:p,isFolder:t.contentDetails&&t.contentDetails.isFolder},p&&this.setStreamEntryClickToGoToDestination(e,r,(function(){n.ultraState.goPeekState(I.b.EDIT_STATE_SREF,{id:r.courseContentId,courseId:e.courseId})}));break;case d.r.ContentHandler.Journal:e.body.stateRef=c.f.getJournalPanelStateRef(r.courseContentId,e.courseId)}e.body.externalRef||e.body.stateRef||e.body.clickHandler||this.setCourseUrlRefToBody(e)},t.prototype.setStreamEntryClickToGoToDestination=function(e,t,n){var r=this;e.body.clickHandler=function(){r.CourseModel.$new(t.courseId).contents.$find(t.courseContentId).$allow(["404","403"]).$then((function(t){if(t.$response){var o=t.$response.status;404===o?r.$modal.open({template:O,scope:null}).result.then((function(){r.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):403===o?r.$modal.open({template:P,scope:null}).result.then((function(){r.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):n()}}))}},t.prototype.group=function(e){var n=c.f,r=t.TYPE;if(n.validateEntriesForGrouping(e,[r])){var o=n.getMostRecentEntry(e),i=o.courseId,a=this.generateGroupedEntryId(i),s={id:a,groupedEntryIds:n.getGroupedEntryIds(e),type:r,providerId:o.providerId,notificationCreationDate:o.notificationCreationDate,icon:"document-multiple",isNew:n.hasNewEntry(e),isImportant:!1,isGroupable:!0,courseId:i,isOrg:o.isOrg,streamCourse:o.streamCourse,header:o.header,title:this.bbLocalize.translateSync({locale:null,key:this._GROUPED_ENTRY_TITLE}),entryContents:this.getGroupedEntryContents(e)};return s.streamCourse.isUltra()&&this.areAllSupportedGroupPeekEntries(s.entryContents)?s.body={stateRef:'content-group({streamEntryId:"'+a+'"})'}:this.setCourseUrlRefToBody(s),[s]}throw new c.e({message:"Could not group stream entries"})},t.prototype.getGroupedEntryContents=function(e){var t=[];return e&&Array.isArray(e)&&e.forEach((function(e){var n=e.entryContents;n?t=t.concat(n):t.push(e)})),t},t.prototype.generateGroupedEntryId=function(e){return["courseContentGroupEntry",t.TYPE,e].join("-")},t.prototype.setCourseUrlRefToBody=function(e){e.body=e.body||{},null!==e.streamCourse&&(e.body.stateRef=c.f.getCoursePanelStateRef(e.streamCourse.id))},t.prototype.areAllSupportedGroupPeekEntries=function(e){var t=this;return e.every((function(e){return I.a.matchesHandlers(e.entrySpecificData.contentItem.contentHandler.toString(),t.SUPPORTED_GROUP_PEEK_TYPES)}))},t.TYPE="CO:CO_AVAIL",t.$inject=[p.serviceName,d.o.serviceName,g.c,S.c,D.d,"$modal","$rootScope","$q"],t}(c.c);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(A);i.module(c.g).service("courseContentStreamEntryTransformer",A);var U=n("KBr+"),w=function(e){function t(n,r){var o=e.call(this,t.SUPPORTED_PROVIDERS)||this;return o.bbLocalize=n,o.CourseBatchLoader=r,o}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);return n.icon="survey",this.processDetails(n,t.itemSpecificData.learnDeploymentDetails),n},t.prototype.processDetails=function(e,t){t.courseId?this.CourseBatchLoader.load(t.courseId).then((function(t){e.courseId=t.id,e.header=t.name})):e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.institution"}),e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.outcomes.bb_deployment",params:{entryTitle:t.instrumentName}}),e.body={type:h.a.SimpleText,content:{bodyText:this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.bb_deployment"})}},t.deploymentUrl&&(e.body.externalRef={target:"new",href:t.deploymentUrl})},t.SUPPORTED_PROVIDERS=["bb_deployment"],t.$inject=[p.serviceName,U.b],t}(c.a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(w);i.module(c.g).service("deploymentStreamEntryTransformer",w);var N=function(e){function t(t,n,r,o,i){var a=e.call(this,t)||this;return a.learnEntryType=t,a.resourceKey=n,a.entryTitlePropertyName=r,a.entryTitleContainsUsersName=o,a.groupingIdPropertyName=i,a}return Object(r.__extends)(t,e),t.prototype.isGroupable=function(){return null!=this.groupingIdPropertyName},t.prototype.getGroupingId=function(e){return e[this.groupingIdPropertyName]},t.prototype.getEntryTitle=function(e){return e[this.entryTitlePropertyName]},t.prototype.isThreadEventType=function(){return t.ThreadPosted.isEqualTo(this)||t.ThreadSubscribed.isEqualTo(this)||t.ThreadUnsubscribed.isEqualTo(this)},t.ForumCreated=new t("FC","forumCreated","forumName",!1,null),t.ForumSubscribed=new t("FS","forumSubscribed","forumName",!0,"forumId"),t.ForumUnsubscribed=new t("FU","forumUnsubscribed","forumName",!0,"forumId"),t.PostRated=new t("PR","postRated","msgTitle",!0,"msgId"),t.ReplyPosted=new t("RP","replyPosted","threadTitle",!0,"threadId"),t.ThreadPosted=new t("TP","threadPosted","threadTitle",!0,null),t.ThreadSubscribed=new t("TS","threadSubscribed","threadTitle",!0,"threadId"),t.ThreadUnsubscribed=new t("TU","threadUnsubscribed","threadTitle",!0,"threadId"),t}(s.a),L=function(e){function t(n){return e.call(this,n,t.SUPPORTED_PROVIDERS)||this}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=t.itemSpecificData.discussionboardDetails;if(n.isIndirect)return null;var r=e.prototype.convert.call(this,t);return r.hasParticipated=t.se_participated,this.processDetails(r,n),this.setLegacyCourseUrlRefToBody(t,r),r},t.prototype.processDetails=function(e,n){var r=N.parse(n.eventType),o=r.isThreadEventType();e.icon=t.ICON,e.isGroupable=!0,e.forumId=n.coreIdContainer,e.forumName=n.forumName,e.threadId=o?n.coreId:n.threadId,e.threadTitle=o?n.title:n.threadName,e.msgEventType=r,e.msgId=n.coreId,e.msgTitle=n.title,e.body={type:h.a.SimpleText,content:{bodyText:n.contentExtract},stateRef:c.f.getDiscussionPanelStateRef(n.courseContentId,e.courseId)},this._setTitle(e)},t.prototype._setTitle=function(e){var t=this,n=["base.stream.entryTitle.disc",e.msgEventType.resourceKey],r=e.msgEventType.entryTitleContainsUsersName,o=e.msgEventType.getEntryTitle(e);r&&e.entrySpecificData&&e.entrySpecificData.streamUser?this.getUserDisplayName(e.entrySpecificData.streamUser).then((function(r){n.push("withName"),e.title=t.bbLocalize.translateSync({locale:null,key:n.join("."),params:{userName:r,entryTitle:o}})})):(r&&n.push("noName"),e.title=this.bbLocalize.translateSync({locale:null,key:n.join("."),params:{userName:null,entryTitle:o}}))},t.prototype.group=function(e){var n=this,r=c.f;if(!r.validateEntriesForGrouping(e,t.SUPPORTED_PROVIDERS))throw new c.e({message:"Could not group stream entries"});var o=[],i={};return e.forEach((function(e){var n=!1;if(e.msgEventType.isGroupable()){var r=e.msgEventType.getGroupingId(e);if(r){n=!0;var a=[r,e.msgEventType].join(t.ENTRY_GROUPING_KEY_DELIMITER);(i[a]=i[a]||[]).push(e)}}n||o.push(e)})),Object.keys(i).forEach((function(e){var a=e.split(t.ENTRY_GROUPING_KEY_DELIMITER),s=a[0],c=a[1],l=i[e];if(l.length>1){var u=r.getMostRecentEntry(l),d=u.courseId,p=r.getGroupedEntryIds(l),f=n.distinctAuthorIds(l),y={id:n.generateGroupedEntryId(d,c,s),forumId:u.forumId,forumName:u.forumName,threadId:u.threadId,threadTitle:u.threadTitle,entrySpecificData:u.entrySpecificData,msgId:u.msgId,msgTitle:u.msgTitle,msgEventType:u.msgEventType,groupedEntryIds:p,authorIds:f,type:u.type,providerId:u.providerId,notificationCreationDate:u.notificationCreationDate,icon:t.ICON,isNew:r.hasNewEntry(l),isImportant:!1,isGroupable:!0,hasParticipated:l.some((function(e){return e.hasParticipated})),courseId:d,isOrg:u.isOrg,header:u.header,headerSubtitle:u.headerSubtitle,title:null,body:u.body};n._setGroupedEntryTitle(y,f.length,u.msgEventType.getEntryTitle(u)),o.push(y)}else o=o.concat(l)})),o},t.prototype._setGroupedEntryTitle=function(e,t,n){var r=this,i=["base.stream.groupedEntries.disc",e.msgEventType.resourceKey];if(e.entrySpecificData&&e.entrySpecificData.streamUser)this.getUserDisplayName(e.entrySpecificData.streamUser).then((function(a){var s=t-1,c=s>0?"plural":"";i.push("withName",c),e.title=r.bbLocalize.translateSync({locale:null,key:o.compact(i).join("."),params:{userName:a,numUsers:s,entryTitle:n}})}));else{var a=t,s=a>0?"plural":"";i.push("noName",s),e.title=this.bbLocalize.translateSync({locale:null,key:o.compact(i).join("."),params:{userName:null,numUsers:a,entryTitle:n}})}},t.prototype.generateGroupedEntryId=function(e,t,n){return["discBoardGroupEntry",e,t,n].join("-")},t.prototype.distinctAuthorIds=function(e){return c.f.getDistinctAuthorIds(e,(function(e){return e.entrySpecificData&&e.entrySpecificData.streamUser&&e.entrySpecificData.streamUser.id||"unknown"}))},t.SUPPORTED_PROVIDERS=["bb_disc"],t.ICON="discussion",t.ENTRY_GROUPING_KEY_DELIMITER="##",t.$inject=[p.serviceName],t}(c.d),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(L);i.module(c.g).service("discussionBoardStreamEntryTransformer",L);var x=n("Sa5G"),j=n("P2dS"),k=n("8jzW"),B=n("KtUo"),M=n("A0nf"),$=n("+O05"),V=function(e){function t(n,r,o,i,a,s,c,l,u){var d=e.call(this,t.SUPPORTED_EVENT_TYPES,u)||this;return d.bbLocalize=n,d.CourseModel=o,d.ColumnModel=i,d.scoreProviderHelper=a,d.gradeColumnCategoryService=s,d.$modal=c,d.$rootScope=l,d.serverTime=r.getServerTime(),d.remove=function(){var e=this;return u.all(this.notificationIds.map((function(t){return o.$new(e.courseId).notifications.$new(t).$destroy().$allow([404]).$asPromise()})))},d}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t),r=this._getEvent(n.type),o=t.itemSpecificData.notificationDetails,i=t.itemSpecificData.contentDetails;return"OVERDUE"===r&&d.tb.NotificationRecipientType.Sender.isEqualTo(o.recipientType)?null:(n.isImportant="OVERDUE"===r,n.isImportant&&(n.remove=this.remove),n.isGroupable=!1,this.processDetails(n,o,i),this.setLegacyCourseUrlRefToBody(t,n),n)},t.prototype.processDetails=function(e,t,n){this._setDueDateDependentProperties(e,t,n),this._setGradebookColumn(e,t)},t.prototype._getEvent=function(e){var t=e.substr(e.indexOf(":")+1);return t.indexOf("_AVAIL")>0?"AVAIL":t},t.prototype._getTitle=function(e,t,n){var r="DUE"===e&&t&&0===B.a(t,this.serverTime)?"dueToday":e.toLowerCase();return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle."+r,params:{entryTitle:n}})},t.prototype._setDueDateDependentProperties=function(e,t,n){var r=t.dueDate&&new Date(t.dueDate),o=this._getEvent(e.type);e.contextualDate="AVAIL"===o?null:r,e.title=this._getTitle(o,e.contextualDate,t.title),e.body={type:h.a.DueDatedContent},r&&this.bbLocalize.formatDatetime(r,c.f.DUE_DATE_FORMAT).then((function(t){e.body.content={localizedDueDate:t}})),this._setClickHandler(e,t,n)},t.prototype._setClickHandler=function(e,t,n){var r=this,o=x.g.parse(n&&n.contentHandler);o&&t.courseId&&t.courseContentId&&(this.scoreProviderHelper.openStateRef(o,{contentId:t.courseContentId,courseId:t.courseId})&&(e.body.clickHandler=function(){r.CourseModel.$new(t.courseId).contents.$find(t.courseContentId).$allow(["404","403"]).$then((function(n){if(n.$response){var i=n.$response.status;404===i?r.$modal.open({template:O,scope:null}).result.then((function(){r.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):403===i?r.$modal.open({template:P,scope:null}).result.then((function(){r.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):r.scoreProviderHelper.openStateRef(o,{contentId:t.courseContentId,courseId:t.courseId,isCollectExternalSubmissions:$.a.isExternalSubmissionsAssessment(n)},k.a.GoToState)}}))}))},t.prototype._setGradebookColumn=function(e,t){if(t.secondarySourceType){var n=F.SOURCETYPE_TO_PROVIDER_MAP[t.secondarySourceType],r=d.F.CalculationType.parse(t.calculationType);n&&(e.entrySpecificData={gradebookColumn:this.ColumnModel.$build({scoreProviderHandle:n,calculationType:r})})}if(!i.isUndefined(t.gradebookCategoryName)&&!i.isUndefined(t.isGradebookCategoryUserDefined)){var o=this.gradeColumnCategoryService.getIconByGradebookCategory(t.gradebookCategoryName,t.isGradebookCategoryUserDefined);o&&(e.icon=o)}},t.SUPPORTED_EVENT_TYPES={AS:["AS:DUE","AS:OVERDUE","AS:AS_AVAIL","AS:AS_GA_AVAIL","AS:AS_AVAIL_RESEND","AS:AS_GA_AVAIL_RESEND"],GB:["GB:DUE","GB:OVERDUE"],SU:["SU:DUE","SU:OVERDUE","SU:SU_AVAIL"],SC:["SC:DUE","SC:OVERDUE","SC:SC_AVAIL","SC:SC_AVAIL_RESEND"],TE:["TE:DUE","TE:OVERDUE","TE:TE_AVAIL","TE:TE_AVAIL_RESEND"],UA:["UA:DUE","UA:OVERDUE","UA:UA_AVAIL","UA:UA_AVAIL_RESEND"]},t.SOURCETYPE_TO_PROVIDER_MAP={BL:M.a.Blog,JN:M.a.Blog,DF:M.a.Discussion,DT:M.a.Discussion,SC:M.a.Scorm,UA:M.a.UltraAssignment,WK:M.a.Wiki},t.$inject=[p.serviceName,u.b,d.o.serviceName,d.F.serviceName,k.c,j.b,"$modal","$rootScope","$q"],t}(c.c),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(V);i.module(c.g).service("duedatedContentStreamEntryTransformer",V);var H=function(e){function t(n){var r=e.call(this,t.SUPPORTED_PROVIDERS)||this;return r.bbLocalize=n,r}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);return n.icon=c.b.DEFAULT_ICON,n.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.goalsAndAssessment"}),this.processDetails(n,t.itemSpecificData.evidenceDetails),n},t.prototype.processDetails=function(e,t){e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.outcomes.bb-evidence-collection",params:{entryTitle:t.title}}),t.sessionDate&&(e.notificationCreationDate=new Date(t.sessionDate)),t.dueDate&&(e.contextualDate=new Date(t.dueDate),e.body={type:h.a.DueDatedContent},this.bbLocalize.formatDatetime(e.contextualDate,c.f.DUE_DATE_FORMAT).then((function(t){e.body.content={localizedDueDate:t}}))),t.evidenceUrl&&(e.body||(e.body={type:h.a.SimpleText}),e.body.externalRef={target:"new",href:R.c(t.evidenceUrl)})},t.SUPPORTED_PROVIDERS=["bb-evidence-collection"],t.$inject=[p.serviceName],t}(c.a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(H);i.module(c.g).service("evidenceCollectionStreamEntryTransformer",H);var z=function(e){function t(n){var r=e.call(this,t.SUPPORTED_PROVIDERS)||this;return r.bbLocalize=n,r}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=t.itemSpecificData.gradeDetails;if(!this._isGraded(n))return null;var r=e.prototype.convert.call(this,t);return r.icon="grades",r.isImportant=!1,r.isGroupable=!1,this.processDetails(r,n),this.setStateRef(r,t.ui&&t.ui.streamCourse),r},t.prototype.processDetails=function(e,t){e.title=this._getTitle(t),e.body={type:h.a.Grades,content:{isInteractive:!0,grade:this._getGrade(t),attemptsRemaining:null,feedback:f.a.text(t.instructorFeedback.displayText),pointsPossible:t.pointsPossible,displayGrade:{grade:t.displayGradeGrade,score:t.displayGradeScore},schema:{scaleType:t.scaleType},column:{possible:t.pointsPossible,calculationType:t.calculationType}}},t.lastGradedDate&&(e.notificationCreationDate=new Date(t.lastGradedDate))},t.prototype.setStateRef=function(e,t){if(t)if(t.isClassic()){var n="/webapps/gradebook/do/student/viewGrades?course_id="+t.id+"&callback=course";e.body.stateRef=c.f.getCoursePanelStateRef(t.id,n)}else e.body.stateRef="course.grades("+i.toJson({courseId:t.id})+")"},t.prototype._getGrade=function(e){return d.tb.GradeIconType.Completed.isEqualTo(e.gradeIcon)?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.grades.completedScore"}):e.grade},t.prototype._getTitle=function(e){return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.grade.posted",params:{entryTitle:e.title}})},t.prototype._isGraded=function(e){return e.grade&&"-"!==e.grade||d.tb.GradeIconType.Completed.isEqualTo(e.gradeIcon)},t.SUPPORTED_PROVIDERS=["bb_mygrades"],t.$inject=[p.serviceName],t}(c.a),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(z);i.module(c.g).service("gradesStreamEntryTransformer",z);var q=function(e){function t(n){return e.call(this,n,t.SUPPORTED_PROVIDERS)||this}return Object(r.__extends)(t,e),t.prototype.convert=function(n){var r=e.prototype.convert.call(this,n);return r.icon=t.ICON,r.isGroupable=!0,this.processDetails(r,n.itemSpecificData.messageDetails),r},t.prototype.processDetails=function(e,t){e.conversationId=t.conversationId,e.isImportant=this.isUltraMessage(t)&&!t.canBeRepliedTo,e.body={type:h.a.SimpleText,content:{bodyText:t.contentExtract},stateRef:this.getBodyStateRef(e,t)},this.setTitle(e)},t.prototype.setTitle=function(e){var t=this;e.entrySpecificData&&e.entrySpecificData.streamUser?this.getUserDisplayName(e.entrySpecificData.streamUser).then((function(n){e.title=t.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newMessage",params:{authorName:n}})})):e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newMessage",params:{authorName:null}})},t.prototype.isUltraMessage=function(e){return!!e.conversationId},t.prototype.getBodyStateRef=function(e,t){return this.isUltraMessage(t)?'stream-message({ courseId: "'+e.courseId+'", conversationId: "'+t.conversationId+'" })':'course.outline({ courseId: "'+e.courseId+'", legacyUrl: "'+R.f("/webapps/blackboard/messaging/course","messageDetail.jsp",{nav:"messages",course_id:e.courseId,folder:"inbox",course_message_id:t.messageId})+'" })'},t.prototype.group=function(e){var n=this,r=c.f;if(!r.validateEntriesForGrouping(e,t.SUPPORTED_PROVIDERS))throw new c.e({message:"Could not group stream entries"});var o=[],i=[],a={};return e.forEach((function(e){e.conversationId?(a[e.conversationId]=a[e.conversationId]||[]).push(e):i.push(e)})),Object.keys(a).forEach((function(e){var i=a[e];if(i.length>1){var s=r.getMostRecentEntry(i),c=s.courseId,l=r.getGroupedEntryIds(i),u=n.distinctAuthorNames(i),d={id:n.generateGroupedEntryId(c,e),groupedEntryIds:l,type:s.type,providerId:s.providerId,notificationCreationDate:s.notificationCreationDate,icon:t.ICON,isNew:r.hasNewEntry(i),isImportant:!1,isGroupable:!0,courseId:c,isOrg:s.isOrg,header:s.header,title:null,hasParticipated:i.some((function(e){return e.hasParticipated})),entrySpecificData:s.entrySpecificData,conversationId:e,body:s.body};n.setGroupedEntryTitle(d,i.length,u),o.push(d)}else o=o.concat(i)})),i.length>0&&(o=o.concat(i)),o},t.prototype.setGroupedEntryTitle=function(e,t,n){e.title=this.bbLocalize.translateSync({locale:null,key:o.compact(["base.stream.groupedEntries.message.title.messageNum.plural"]).join("."),params:{numUnreadMessages:t}}),this.bbLocalize.formatItems(n,2,null,!0,null).then((function(t){e.title+=t}))},t.prototype.generateGroupedEntryId=function(e,t){return["messageBoardGroupEntry",e,t].join("-")},t.prototype.distinctAuthorNames=function(e){var t=this;return c.f.getDistinctAuthorIds(e,(function(e){var n;return e.entrySpecificData&&e.entrySpecificData.streamUser&&(n=t.bbLocalize.formatUsernameSync(e.entrySpecificData.streamUser,p.ILocaleUsernameFormat.Short,null,{noWrap:!0,noEscape:!0})),n||"unknown"}))},t.SUPPORTED_PROVIDERS=["bb_message"],t.ICON="message",t.$inject=[p.serviceName],t}(c.d),K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(q);i.module(c.g).service("messageStreamEntryTransformer",q);var J=function(e){function t(n,r,o){var i=e.call(this,t.SUPPORTED_EVENT_TYPES,o)||this;return i.bbLocalize=n,i.scoreProviderHelper=r,i}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);n.isImportant=!1,n.isGroupable=!1,n.title=this._getTitle(n.notificationIds,t.itemSpecificData.notificationDetails.title);var r=t.itemSpecificData.notificationDetails,o=x.g.parse(t.itemSpecificData.contentDetails&&t.itemSpecificData.contentDetails.contentHandler);n.icon=this._getNeedsGradingIcon(o);var i=t.ui.streamCourse&&t.ui.streamCourse.isUltra();return this._setStateRef(n,r,o,i),i||this.setLegacyCourseUrlRefToBody(t,n),n},t.prototype._getNeedsGradingIcon=function(e){var t=this.scoreProviderHelper.getNeedsGradingIconByContentHandler(e);return t||(t="grades"),t},t.prototype._getTitle=function(e,t){return e.length>1?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newSubmission.multipleNoCount",params:{entryTitle:t}}):this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newSubmission.single",params:{entryTitle:t}})},t.prototype._setStateRef=function(e,t,n,r){var o=t.courseId,i=t.courseContentId;if(r&&o&&i&&n){if(("TE:TE_GT_SUBMIT"===e.type||"TE:TE_GT_SUBMIT_LATE"===e.type||"UA:UA_GA_SUBMIT"===e.type||"UA:UA_GA_SUBMIT_LATE"===e.type)&&d.tb.NotificationRecipientType.Sender.isEqualTo(t.recipientType))return;var a=this.scoreProviderHelper.getSubmissionListStateRefByContentHandler(n,{contentId:i,courseId:o});a&&(e.body={stateRef:a})}},t.SUPPORTED_EVENT_TYPES={AS:["AS:AS_ATTEMPT","AS:AS_LATE_ATTEMPT","AS:AS_GA_ATTEMPT","AS:AS_GA_LATE_ATTEMPT"],BL:["BL:BL_ATTEMPT","BL:BL_GR_ATTEMPT"],DF:["DF:DF_ATTEMPT","DF:DF_GR_ATTEMPT"],DT:["DT:DT_ATTEMPT","DT:DT_GR_ATTEMPT"],JN:["JN:JN_ATTEMPT","JN:JN_GR_ATTEMPT"],SC:["SC:SC_SUBMIT","SC:SC_SUBMIT_LATE"],TE:["TE:TE_SUBMIT","TE:TE_SUBMIT_LATE","TE:TE_GT_SUBMIT","TE:TE_GT_SUBMIT_LATE"],UA:["UA:UA_SUBMIT","UA:UA_SUBMIT_LATE","UA:UA_GA_SUBMIT","UA:UA_GA_SUBMIT_LATE"],WK:["WK:WK_ATTEMPT","WK:WK_GR_ATTEMPT"]},t.$inject=[p.serviceName,k.c,"$q"],t}(c.c),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(J);i.module(c.g).service("needsGradingStreamEntryTransformer",J);var X=n("aHpC"),Q=function(e){function t(n,r,o){var i=e.call(this,t.SUPPORTED_EVENT_TYPES,o)||this;return i.bbLocalize=n,i.scoreProviderHelper=r,i}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t);n.isImportant=!1,n.isGroupable=!1;var r=t.itemSpecificData.notificationDetails,o=x.g.parse(t.itemSpecificData.contentDetails&&t.itemSpecificData.contentDetails.contentHandler);n.icon=this._getNeedReconcilingIcon(o),n.title=this._getTitle(n.type,t.ui.streamCourse,r.title);var i=t.ui.streamCourse&&t.ui.streamCourse.isUltra();return this._setStateRef(n,r,o,i),i||this.setLegacyCourseUrlRefToBody(t,n),n},t.prototype._getNeedReconcilingIcon=function(e){var t=this.scoreProviderHelper.getNeedsReconcilingIconByContentHandler(e);return t||(t="grades"),t},t.prototype._getTitle=function(e,t,n){var r=e.substr(e.indexOf(":")+1);return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.simple."+r,params:{entryTitle:n}})},t.prototype._setStateRef=function(e,t,n,r){var o=t.courseId,i=t.courseContentId;if(r&&o&&i&&n){var a=this.scoreProviderHelper.getSubmissionListStateRefByContentHandler(n,{contentId:i,courseId:o});a&&(e.body={stateRef:a})}},t.SUPPORTED_EVENT_TYPES={GB:["GB:GB_NEEDS_RECON"]},t=Object(r.__decorate)([Object(r.__param)(0,Object(X.b)(p.serviceName)),Object(r.__param)(1,Object(X.b)(k.c)),Object(r.__param)(2,Object(X.b)("$q"))],t)}(c.c);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(Q);i.module(c.g).service("needsReconcilingtreamEntryTransformer",Q);var Z=function(e){function t(n,r){var o=e.call(this,t.SUPPORTED_EVENT_TYPES,r)||this;return o.bbLocalize=n,o}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=t.itemSpecificData.notificationDetails;if(n&&"CM"===n.sourceType)return null;var r=e.prototype.convert.call(this,t);return r.isImportant=!1,r.isGroupable=!1,r.title=this._getTitle(r.type,t.ui.streamCourse,n.title),this.setLegacyCourseUrlRefToBody(t,r),r},t.prototype._getTitle=function(e,t,n){var r=e.substr(e.indexOf(":")+1);return"CR_AVAIL"===r&&t&&t.isOrganization&&(r="ORG_AVAIL"),this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.simple."+r,params:{entryTitle:n}})},t.SUPPORTED_EVENT_TYPES={CR:["CR:CR_AVAIL"],SU:["SU:SU_SUBMIT"],QU:["QU:QU_AVAIL"],CM:["CM:CM_RCVD"]},t.$inject=[p.serviceName,d.o.serviceName,"$q"],t}(c.c),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t}(Z);i.module(c.g).service("simpleLegacyStreamEntryTransformer",Z);var te=n("ZNC7"),ne=n("r6lH"),re=n("zyQz"),oe=n("EtRF"),ie=n("M+Ig"),ae=function(e){function t(n,r,o){var i=e.call(this,t.SUPPORTED_EVENT_TYPES)||this;return i.bbLocalize=n,i.telemetry=r,i.remove=function(){var e=this.body.content.notificationId;return null==e&&(e="_"+this.body.content.sequenceId+"_1"),o.$new(e).$destroy().$asPromise()},i.analyticsContext=function(e){return e.notificationType=this.body.content.notificationType.toString(),this.body.content.phraseVariant&&(e.phraseVariant=this.body.content.phraseVariant),e},i}return Object(r.__extends)(t,e),t.prototype.convert=function(t){var n=e.prototype.convert.call(this,t),r=re.a.parse(t.extraAttribs.notificationType),o=t.extraAttribs.notificationId,i=r&&r.getInitialView(),a=r?r.getPhraseVariant(t):void 0,s=r?r.getIcon().toString():oe.a.DEFAULT.toString(),l=c.f.getSequenceId(t),u=r&&r.getAction(null);return n.icon=s,n.isGroupable=!1,n.title=this._getTitle(r,t),n.isImportant="true"===t.extraAttribs.important,n.telemetryNotificationType=r&&r.toString(),(t.extraAttribs.inTroubleCount||t.extraAttribs.inTroubleAbsent||t.extraAttribs.inTroubleFailing)&&(n.studentsInTrouble={studentsInTrouble:t.extraAttribs.inTroubleCount,studentsInTroubleAbsent:t.extraAttribs.inTroubleAbsent,studentsInTroubleFailing:t.extraAttribs.inTroubleFailing}),n.notificationShapeType={shape:this._getNotificationShapeType(r)},n.body={type:this._getBodyType(u),content:{bodyText:this._getBody(r,t),sequenceId:l,notificationType:r,notificationId:o,phraseVariant:a}},n.remove=this.remove,n.analyticsContext=this.analyticsContext,null==o&&(o="_"+l+"_1"),this._setBodyStateRef(u,n,o,i),n},t.prototype._getBodyType=function(e){return e?h.a.Telemetry:h.a.SimpleText},t.prototype._getTitle=function(e,t){return e?this.bbLocalize.translateSync(e.getTitle(t,null)):this.bbLocalize.translateSync({locale:null,key:"base.stream.telemetry.unknownType",params:{type:t.extraAttribs.notificationType}})},t.prototype._getBody=function(e,t){if(e){var n=e.getBody(t,null);if(n.key)return this.bbLocalize.translateSync(n)}return""},t.prototype._setBodyStateRef=function(e,t,n,r){var o=this;if(r)switch(r){case ie.a.DirectToCourse:var i=c.f.getCoursePanelStateRef(t.courseId);this._setStateRefProps(e,t,i,!0);break;case ie.a.InstructorDynamic:this.telemetry.determinePanelSref(t.courseId,n).then((function(n){o._setStateRefProps(e,t,n)}));break;default:var a=this.telemetry.createPanelSref(r,t.courseId,n);this._setStateRefProps(e,t,a)}},t.prototype._setStateRefProps=function(e,t,n,r){void 0===r&&(r=!1),e?(t.body.content.actionText=this.bbLocalize.translateSync(e),t.body.content.actionSref=n,t.body.content.isComponentActionSref=r):t.body.stateRef=n},t.prototype._getNotificationShapeType=function(e){var t;switch(e){case re.a.SufficientActivityData:case re.a.SufficientGradeData:case re.a.StudentsInTrouble:t=te.a.DefaultNotification;break;default:t=te.a.BoxNotification}return t},t.SUPPORTED_EVENT_TYPES=["bb_tel","bb_tel:ins_grade","bb_tel:stu_activity","bb_tel:stu_grade"],t.$inject=[p.serviceName,ne.b,d.Ib.serviceName],t}(c.a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(ae);i.module(c.g).service("telemetryStreamEntryTransformer",ae),n.d(t,"b",(function(){return se})),n.d(t,"c",(function(){return ce})),n.d(t,"a",(function(){return le}));var se="ultra.service.stream.transformer",ce="streamEntryTransformer",le=function(e){function t(t,n){var r=e.call(this,t)||this;return r.supportedTypes=n,r}return Object(r.__extends)(t,e),t.prototype.getSupportedTypes=function(){return this.supportedTypes},t.AssignmentsAndTests=new t("AssignmentsAndTests",o.union(F.SUPPORTED_EVENT_TYPES.AS,F.SUPPORTED_EVENT_TYPES.TE,F.SUPPORTED_EVENT_TYPES.UA)),t.GradesAndFeedback=new t("GradesAndFeedback",o.union(B.b(W.SUPPORTED_EVENT_TYPES),Y.SUPPORTED_PROVIDERS,ee.SUPPORTED_EVENT_TYPES.GB)),t.Discussions=new t("Discussions",G.SUPPORTED_PROVIDERS),t.Messages=new t("Messages",K.SUPPORTED_PROVIDERS),t}(s.a),ue=function(){function e(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this._baseDataTransformer=e,this.typeToTransformer=Object.create(null),this._dataTransformers=t||[]}return Object.defineProperty(e.prototype,"dataTransformers",{get:function(){return this._dataTransformers},set:function(e){this._dataTransformers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseDataTransformer",{get:function(){return this._baseDataTransformer},set:function(e){this._baseDataTransformer=e},enumerable:!0,configurable:!0}),e.prototype.getDataTransformerByType=function(e){return this.typeToTransformer[e]=this.typeToTransformer[e]||this._lookupDataTransformerByType(e)},e.prototype._lookupDataTransformerByType=function(e){var t=this.dataTransformers.filter((function(t){return t.canHandleType(e)}));return t&&t[0]||this.baseDataTransformer},e.REGISTERED_DATA_TRANSFORMERS=[m,"calendarStreamEntryTransformer","collabStreamEntryTransformer","courseContentStreamEntryTransformer","deploymentStreamEntryTransformer","discussionBoardStreamEntryTransformer","duedatedContentStreamEntryTransformer","evidenceCollectionStreamEntryTransformer","gradesStreamEntryTransformer","messageStreamEntryTransformer","needsGradingStreamEntryTransformer","simpleLegacyStreamEntryTransformer","telemetryStreamEntryTransformer","needsReconcilingtreamEntryTransformer"],e.$inject=[c.h].concat(e.REGISTERED_DATA_TRANSFORMERS),e}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(ue);i.module(se,[c.g]).service(ce,ue)},sbY4:function(e,t){e.exports='<p class="summary js-feedback" ng-if="::interactiveBodyContent.content.feedback" ng-bind-html="::interactiveBodyContent.content.feedback"></p>\n<span ng-if="::interactiveBodyContent.content">\n  <span class="stream-grade-controls">\n\n    <button id="streamEntryBodyViewGradeButton{{::interactiveBodyContent.id}}"\n            class="button button--secondary round small"\n            ng-click="interactiveBodyContent.showTheContent()"\n            bb-click-focus="#grade-value{{::interactiveBodyContent.id}} .wrapping-input-style"\n            ng-hide="interactiveBodyContent.showContent"\n            bb-translate bb-translate-attrs="{ \'aria-label\': \'base.stream.entryBody.grades.viewGrade\' }"\n            analytics-id="base.stream.entryBody.grades.viewGrade">\n      base.stream.entryBody.grades.viewGrade\n    </button>\n    \x3c!--removing aria-hidden as it is redundant ng-show is enough as it hides the content\n    cleaning this up to prevent potential bugs--\x3e\n    <div class="js-grade stream-grade"\n         ng-show="interactiveBodyContent.showContent">\n      <bb-display-grade id="grade-value{{::interactiveBodyContent.id}}" class="grade-value"\n                        column="interactiveBodyContent.content.column" grade-detail="interactiveBodyContent.content"\n                        schema="interactiveBodyContent.content.schema" display-type="GradeColor" aria-live="assertive"></bb-display-grade>\n      <button class="anchor" id="streamEntryBodyHideGradeLink{{::interactiveBodyContent.id}}"\n         ng-click="interactiveBodyContent.hideTheContent()"\n         bb-click-focus="#streamEntryBodyViewGradeButton{{::interactiveBodyContent.id}}"\n         bb-translate\n         analytics-id="base.stream.entryBody.grades.hideGrade">\n        base.stream.entryBody.grades.hideGrade\n      </button>\n    </div>\n\n  </span>\n  <div class="row js-attemptsRemaining"\n       ng-if="::interactiveBodyContent.content.attemptsRemaining"\n       bb-translate translate-values="{ numberOfAttemptsLeft: {{::interactiveBodyContent.content.attemptsRemaining}} }">\n    base.stream.entryBody.grades.attemptsLeft.plural\n  </div>\n</span>\n'},tdYh:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=/^\w+\:{1}/},u2fd:function(e,t){e.exports='<p class="summary" ng-if="bodyContent().bodyText" ng-bind-html="bodyContent().bodyText"></p>'},xpqL:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return m}));var r=n("D57K"),o=n("wHJ2"),i=n("nsO7"),a=n("7C3+"),s=n("0JpG"),c=n("pjml"),l=n("iG2q"),u=n("yC9S"),d=n("adx1"),p=n("MOka"),f=n("z6Q5"),y=n("aHpC"),h="ultra.service.stream.manager",m="streamEntryManager",b=["GB:GB_ATT_UPDATED","GB:GB_GRA_UPDATED","GB:GB_GRA_CLEARED"],E=function(e){function t(t,n,r,o,i,a,s,c,l,d){var p=e.call(this)||this;return p.$log=t,p.$q=n,p.$rootScope=r,p.$timeout=o,p.BatchApiService=i,p.bbLocalize=a,p.streamSettingsService=s,p.CourseModel=c,p.StreamContentModel=l,p.transformer=d,p.providers={},p.entries=[],p.deletedIds=[],p.userCache={},p.courseCache={},p.userCourseAvailabilities={},p.hasMoreData=!0,u.b.OnRootScope(p.$rootScope,"membership.update",(function(e,t,n,r,o,i,a,s){p.userCourseAvailabilities[s]&&(p.userCourseAvailabilities[s][a.id]=t.isAvailable)})),p}return Object(r.__extends)(t,e),t.prototype.loadBundle=function(){return this.bbLocalize.loadBundle("features/base/stream/base-stream")},t.prototype.loadAllStreamEntries=function(e,t){var n=this;return this.$q.all([this.getEntries(t),this.loadBundle()]).then((function(t){return n.hasMoreData&&n.getMoreEntries().then((function(t){e&&e(n.processStreamData(t))})),n.processStreamData(t[0])}),(function(){return{entries:[],deletedIds:[]}}))},t.prototype.removeStreamEntryFromServer=function(e){if(e&&e.isImportant&&e.remove)return e.remove();var t=this.$q.defer();return t.reject("Can only remove important notifications with remove method"),t.promise},t.prototype.processStreamEntries=function(e){var t=this;return(e||[]).map((function(e){return e&&t.processStreamEntry(e)})).filter((function(e){return e&&b.indexOf(e.type)<0}))},t.prototype.processStreamEntry=function(e){var t=a.f.getEntryType(e);return this.transformer.getDataTransformerByType(t).convert(e)},t.prototype.processGroupStreamEntry=function(e,t){var n=this.transformer.getDataTransformerByType(t);if(n.group)try{return n.group(e)}catch(e){this.$log.log(e)}else this.$log.log("Method for grouping stream entries does not exist for data transformer used for processing entries with type of "+t);return e},t.prototype.processStreamData=function(e,n){var r=this;void 0===n&&(n=[]);var o={entries:this.processStreamEntries(e.entries),deletedIds:e.deletedIds},a=new Set;return o.entries.filter((function(e){var t=e.courseId,n=e.entrySpecificData;return t&&i.at(n||{},"streamUser.avatar.permanentUrl")[0]})).filter((function(e){var n=e.courseId;return(new Date).getTime()-(r.userCourseAvailabilities[n]||{_lastUpdatedAt:0})._lastUpdatedAt>t.MIN_INTERNAL_COURSE_MEMBERSHIP_FETCH_IN_MS})).forEach((function(e){var t=e.courseId;a.add(t)})),n.push(this.BatchApiService.performBatch((function(){a.forEach((function(e){r.CourseModel.$new(e).memberships.$fetch({limit:1e4}).$asPromise().then((function(t){var n=r.userCourseAvailabilities[e]||(r.userCourseAvailabilities[e]={});n._lastUpdatedAt=(new Date).getTime(),t.forEach((function(e){n[e.userId]=e.isAvailable}))}))}))}))),o},t.prototype._reset=function(){this.startTime=Date.now(),this.lastCall=null,this.entries=[],this.deletedIds=[]},t.prototype.getEntries=function(e){return this._reset(),this._getRawEntries(!1,e)},t.prototype.getMoreEntries=function(){var e=this.$q.when({entries:[],deletedIds:[]});return this.hasMoreData?this.getEntries(!1):e},t.prototype._shouldKeepLoading=function(){return Date.now()-this.startTime<this.gracePeriod&&this.hasMoreData},t.prototype._collectEntries=function(e){return this.entries=this.entries.concat(e.sv_streamEntries),this.deletedIds=this.deletedIds.concat(e.sv_deletedIds),this.$emitEvent("STREAM_CONTENT_PULLED",{entries:this.processStreamEntries(e.sv_streamEntries),deletedIds:e.sv_deletedIds}),this._shouldKeepLoading()?this._getRawEntries(!0,!1):this.$q.when({entries:this.entries,deletedIds:this.deletedIds})},t.prototype._getRawEntries=function(e,n){var r=this,o=this.lastCall?Math.max(0,t.GET_ENTRIES_CALL_INTERVAL-(Date.now()-this.lastCall)):0;return this.$timeout((function(){r.lastCall=Date.now();var o=r._generatePayload(e,n);return r.StreamContentModel.$new(t.ULTRA_STREAM_ID).$fetch(o).$asPromise().then((function(e){return r._processProviders(e.sv_providers),r._cacheCourses(e.sv_extras.sx_courses),r._cacheUsers(e.sv_extras.sx_users),r.gracePeriod=1e3*e.sv_autoDisplayGracePeriodSeconds,r.hasMoreData=e.sv_moreData,r._populateExtras(e.sv_streamEntries),r._collectEntries(e)})).catch((function(e){return r.hasMoreData=!1,r.$rootScope.$emit(t.STREAMS_LOADING_ERROR_EVENT),r.$q.reject(e)}))}),o)},t.prototype._processProviders=function(e){var t=this;e&&e.forEach((function(e){t.providers[e.sp_provider]={sp_provider:e.sp_provider,sp_newest:e.sp_newest,sp_oldest:e.sp_oldest,sp_refreshDate:e.sp_refreshDate}}))},t.prototype._cacheCourses=function(e){var t=this;(e||[]).forEach((function(e){t.courseCache[e.id]=t.CourseModel.$build(e)}))},t.prototype._cacheUsers=function(e){var t=this;e.filter((function(e){return null!=e.sx_user})).forEach((function(e){t.userCache[e.sx_id]=e.sx_user}))},t.prototype._populateExtras=function(e){var n=this,r=Object.keys(this.userCache).length>0,o=Object.keys(this.courseCache).length>0;e.forEach((function(e){if(e.ui={},r&&(e.ui.streamUser=e.se_userId&&n.userCache[e.se_userId]||null),o){var s=a.f.getCourseId(e);e.ui.streamCourse=s&&n.courseCache[s]||null}e.itemSpecificData=i.omitBy(e.itemSpecificData,i.isNull);var c=t.DETAIL_NAMES[e.providerId];if(c){var l=e.itemSpecificData[c];i.defaults(l,i.omit(e.itemSpecificData,c))}}))},t.prototype._generatePayload=function(e,t){var n=!!o.isDefined(t)&&t;return{providers:this.providers,forOverview:!1,retrieveOnly:e,flushCache:n}},t.prototype.$onStreamPulled=function(t){return e.prototype.$onEvent.call(this,"STREAM_CONTENT_PULLED",t)},t.STREAMS_LOADING_ERROR_EVENT="streams-fetching-error",t.MIN_INTERNAL_COURSE_MEMBERSHIP_FETCH_IN_MS=3e4,t.GET_ENTRIES_CALL_INTERVAL=1e3,t.ULTRA_STREAM_ID="ultra",t.DETAIL_NAMES={"bb-announcement":"notificationDetails",bb_blog:"blogDetails",bb_calendar:"calendarDetails",bb_disc:"discussionboardDetails","bb-evidence-collection":"evidenceDetails",bb_mygrades:"gradeDetails",bb_deployment:"learnDeploymentDetails",bb_message:"messageDetails","bb-nautilus":"notificationDetails",bb_Wiki:"wikiDetails"},t=Object(r.__decorate)([Object(r.__param)(0,Object(y.b)("$log")),Object(r.__param)(1,Object(y.b)("$q")),Object(r.__param)(2,Object(y.b)("$rootScope")),Object(r.__param)(3,Object(y.b)("$timeout")),Object(r.__param)(4,Object(y.b)(f.b)),Object(r.__param)(5,Object(y.b)(s.serviceName)),Object(r.__param)(6,Object(y.b)(p.b)),Object(r.__param)(7,Object(y.b)(c.o.serviceName)),Object(r.__param)(8,Object(y.b)(c.tb.serviceName)),Object(r.__param)(9,Object(y.b)(l.c))],t)}(d.a);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(r.__extends)(t,e)}(E);o.module(h,[c.R,f.a,l.b,p.a]).service(m,E)}}]);