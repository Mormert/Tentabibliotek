(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{BjFu:function(e,r,t){"use strict";t.d(r,"a",(function(){return l})),t.d(r,"b",(function(){return b}));var s=t("D57K"),i=t("nsO7"),n=t("wHJ2"),o=t("yC9S"),m=t("Fvsw"),a=t("go4a"),u=t("pjml"),c=t("zdqs"),p=t("SoDU"),d=t("fYJU"),h=t("aHpC"),l="ultra.service.termMembership",b="termMembership",f=function(){function e(e,r,t,s,i,n,m,a,u){var c=this;this.$q=e,this.context=t,this.CourseModel=s,this.CourseMembershipModel=i,this.TermModel=n,this.UserModel=m,this.ExternalCourseModel=a,this.contextUser=u,o.b.OnRootScope(r,"courseUltraStatusChanged",(function(e,r,t){c.updateCourseUltraStatus(r,t)}))}return e.prototype.clear=function(){this.termsAndMemberships=void 0,this.loadPromise=void 0},e.prototype.getTermsAndMemberships=function(){return this.loadPromise?this.loadPromise:this.reloadTermsAndMemberships()},e.prototype.filterMemberships=function(e,r,t){return e&&Array.isArray(e)?e.filter((function(e){return!e.course.isOrganization===r||!!e.course.isOrganization===t})):[]},e.prototype.getCourseMembershipsFromArray=function(e){return this.filterMemberships(e,!0,!1)},e.prototype.getOrganizationMembershipsFromArray=function(e){return this.filterMemberships(e,!1,!0)},e.prototype.parseMembershipFromExternalCourse=function(e){var r=this.CourseMembershipModel.$new();return r.course=this.CourseModel.$new(),r.course.id=e.id,r.course.name=e.title,r.course.description=e.description,r.course.displayName=e.title,r.course.startDate=e.startDate,r.course.endDate=e.endDate,r.course.isAvailable=!0,r.course.durationType=u.o.CourseDuration.DateRange,r.userId=e.userId,r.isAvailable=!0,r.userHasHidden=e.isHidden,r.courseCardColorIndex=parseInt((e.id||"0").replace(/_1$/,"").replace(/[^\d]/g,""),10),r.course.ui={courseColorClass:a.a(r),courseBannerImage:r.getBannerImageFilename(),courseBannerImageThumbnail:r.getBannerImageThumbnailFilename(),isExternal:!0,description:e.description,externalUrl:e.url},r},e.prototype.parseExternalCourseFromMembership=function(e){var r=this.ExternalCourseModel.$new(e.course.id);return r.id=e.course.id,r.title=e.course.name,r.startDate=e.course.startDate,r.endDate=e.course.endDate,r.userId=e.userId,r.description=e.course.ui.description,r.url=e.course.ui.externalUrl,r.isHidden=e.userHasHidden,r},e.prototype.fetchMemberships=function(e){return e.memberships.$fetch({limit:1e4,expand:"course.effectiveAvailability,course.permissions,courseRole"}).$asPromise()},e.prototype.reloadTermsAndMemberships=function(){var e=this,r=this.$q.defer();this.loadPromise=r.promise,this.termsAndMemberships={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};var t=this.context.getServerTime();return this.$q.all([this.getInternalMembership(),this.getExternalCoursesMembership(),this.updateTermsAndMemberships()]).then((function(s){var n=s[0],o=s[1];e.termsAndMemberships.membershipsByTermId=Object.create(null),e.termsAndMemberships.memberships.splice(0,e.termsAndMemberships.memberships.length),n.forEach((function(r){e.termsAndMemberships.memberships.push(r)})),o.forEach((function(r){e.termsAndMemberships.memberships.push(r)})),e.associateTermsWithCourses(),e.applyTermAvailability();var m=new p.a(e.TermModel,e.termsAndMemberships.terms),a=new c.a(m).map(e.termsAndMemberships.memberships,t);(a=e.applyStudentAvailabilityRules(a)).forEach((function(r){var t=function(t){var s=e.termsAndMemberships.membershipsByTermId[t.id];s||(s=e.termsAndMemberships.membershipsByTermId[t.id]={memberships:[]}),s.memberships.push(r.membership)};t(r.term);var s=r.membership.course.term;!s||r.term!==m.currentTerm&&r.term!==m.upcomingTerm||t(s),e.buildTermRelationships(r)})),Object.keys(e.termsAndMemberships.membershipsByTermId).forEach((function(r){var t=e.termsAndMemberships.membershipsByTermId[r];t.memberships=i.sortBy(t.memberships,(function(e){return e.course.name}))})),r.resolve(e.termsAndMemberships)})),this.loadPromise},e.prototype.getInternalMembership=function(){var e=this,r=this.UserModel.$new(this.contextUser.userId);return this.fetchMemberships(r).then((function(r){return r.forEach((function(e){e.course&&(e.course.term&&(e.course.term.id=e.course.term.$pk),e.course.ui={courseColorClass:a.a(e),courseBannerImage:e.getBannerImageFilename(),courseBannerImageThumbnail:e.getBannerImageThumbnailFilename()})})),e.getActiveMemberships(r)}))},e.prototype.getActiveMemberships=function(e){return e.filter((function(e){return e.course&&e.isAvailable}))},e.prototype.getExternalCoursesMembership=function(){var e=this;return this.ExternalCourseModel.$search({limit:1e4}).$asPromise().then((function(r){return r.map((function(r){return e.parseMembershipFromExternalCourse(r)}))}))},e.prototype.updateTermsAndMemberships=function(){var e=this;return this.TermModel.$search().$asPromise().then((function(r){e.termsAndMemberships.terms=i.orderBy(r,["startDate","durationType"],["asc","desc"]);var t=p.a.decorateTerm(new e.TermModel,u.Nb.ConstantTermId.CurrentTerm.toString()),s=p.a.decorateTerm(new e.TermModel,u.Nb.ConstantTermId.UpcomingTerm.toString());e.termsAndMemberships.terms.push(t,s)}))},e.prototype.associateTermsWithCourses=function(){var e=this;this.termsAndMemberships.memberships.forEach((function(r){r.course.term&&(r.course.term=e.termsAndMemberships.terms.find((function(e){return e.id===r.course.term.id})))}))},e.prototype.applyTermAvailability=function(){this.termsAndMemberships.memberships.forEach((function(e){if(u.o.CourseDuration.UseTerm.isEqualTo(e.course.durationType)){var r=e.course.term;r&&Object.prototype.hasOwnProperty.call(r,"isAvailable")&&(e.course.isHonorTermAvailability?e.course.isAvailable=r.isAvailable:e.course.term.isAvailable||(e.course.isAvailable=!1))}}))},e.prototype.buildTermRelationships=function(e){var r=this.termsAndMemberships.termsByTermId[e.term.id];if(e.membership.course.term){if(e.term.id!==e.membership.course.term.id){if(!r)return void(this.termsAndMemberships.termsByTermId[e.term.id]=[e.membership.course.term]);r.indexOf(e.membership.course.term)<0&&r.push(e.membership.course.term)}}else;this.termsAndMemberships.termsByTermId[e.term.id]=i.orderBy(r,["startDate","name"],["desc","asc"])},e.prototype.applyStudentAvailabilityRules=function(e){return e.filter((function(e){return e.membership.isStudentOrGuestMembership()&&(e.membership.course.isUndecided()?e.membership.course.isAvailable=!1:u.Nb.ConstantTermId.UpcomingTerm.isEqualTo(e.term.id)&&(e.membership.course.isAvailable=!1)),!0}))},e.prototype.getCourseMembership=function(e){var r=this.findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==r)return this.termsAndMemberships.memberships[r]},e.prototype.findCourseMembership=function(e,r){return r.findIndex((function(r){return r.course.id===e}))},e.prototype.updateCourseUltraStatus=function(e,r){var t=this,s=this.findCourseMembership(e,this.termsAndMemberships.memberships);-1!==s&&(this.termsAndMemberships.memberships[s].course.ultraStatus=r),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((function(i){-1!==(s=t.findCourseMembership(e,t.termsAndMemberships.membershipsByTermId[i].memberships))&&(t.termsAndMemberships.membershipsByTermId[i].memberships[s].course.ultraStatus=r)}))},e.prototype.filterAssociatedWithTermCourseMembershipsByTerm=function(e,r){return this.filterAssociatedWithTermCourseMemberships(e).filter((function(e){return e.course.term.id===r.id}))},e.prototype.filterAssociatedWithTermCourseMemberships=function(e){return e.filter((function(e){return e.course.term&&!u.o.CourseDuration.Continuous.isEqualTo(e.course.term.durationType)}))},e.prototype.filterAssortedDatesCourseMemberships=function(e){return e.filter((function(e){return null==e.course.term||e.course.term&&u.o.CourseDuration.Continuous.isEqualTo(e.course.term.durationType)}))},e=Object(s.__decorate)([Object(s.__param)(0,Object(h.b)("$q")),Object(s.__param)(1,Object(h.b)("$rootScope")),Object(s.__param)(2,Object(h.b)(m.b)),Object(s.__param)(3,Object(h.b)(u.o.serviceName)),Object(s.__param)(4,Object(h.b)(u.v.serviceName)),Object(s.__param)(5,Object(h.b)(u.Nb.serviceName)),Object(s.__param)(6,Object(h.b)(u.Qb.serviceName)),Object(s.__param)(7,Object(h.b)(u.B.serviceName)),Object(s.__param)(8,Object(h.b)(d.b))],e)}();!function(e){function r(){return null!==e&&e.apply(this,arguments)||this}Object(s.__extends)(r,e)}(f);n.module(l,[m.a,u.R]).service(b,f)},SoDU:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));var s=t("VdDF"),i=t("pjml"),n=function(){function e(e,r){this.TermModel=e,this.terms=r,this.currentTerm=this.getTerm(i.Nb.ConstantTermId.CurrentTerm.toString()),this.upcomingTerm=this.getTerm(i.Nb.ConstantTermId.UpcomingTerm.toString())}return e.prototype.getTerm=function(e){return this.terms.filter((function(r){return r.id===e}))[0]},e.decorateTerm=function(e,r){return e.id=r,e.ui={type:r},e},e.prototype.createYearTerm=function(e){var r=e.getFullYear(),t="year-"+r,s=this.getTerm(t);return s||((s=new this.TermModel).id=t,s.ui={type:"year",year:r},s.startDate=new Date(r,0),this.addTerm(s)),s},e.prototype.addTerm=function(e){if(e)for(var r=0;r<this.terms.length;r++)if(this.terms[r].startDate>=e.startDate||this.terms[r]===this.currentTerm)return void this.terms.splice(r,0,e)},e.prototype.filterTerm=function(e){return this.terms.filter((function(r){return!!i.Nb.TermDuration.DateRange.isEqualTo(r.durationType)&&s.a.isWithinDateRange(e,{start:r.startDate,end:r.endDate})}))},e}()},lGua:function(e,r,t){var s=t("ziER"),i=t("5JeM"),n=new s({id:"icon-small-settings",use:"icon-small-settings-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-settings"><path d="M7.5977 1.5453c.1998-.2709.6048-.2709.8046 0l.9644 1.307a.5.5 0 0 0 .5534.1798l1.5484-.4906c.3209-.1016.6485.1364.651.473l.0119 1.6242a.5001.5001 0 0 0 .342.4707l1.5411.5133c.3193.1064.4445.4916.2486.7653l-.945 1.321a.5002.5002 0 0 0 0 .582l.945 1.321c.1959.2737.0707.6589-.2486.7653l-1.5411.5133a.5.5 0 0 0-.342.4706l-.0119 1.6243c-.0025.3366-.3301.5746-.651.473L9.92 12.9679a.5.5 0 0 0-.5533.1798l-.9644 1.307c-.1998.2709-.6048.2709-.8046 0l-.9644-1.307a.5.5 0 0 0-.5534-.1798l-1.5484.4906c-.3209.1016-.6485-.1364-.651-.473l-.012-1.6243a.4999.4999 0 0 0-.342-.4706l-1.541-.5133c-.3193-.1064-.4445-.4916-.2486-.7653l.945-1.321a.5.5 0 0 0 0-.582l-.945-1.321c-.1959-.2737-.0707-.6589.2486-.7653l1.541-.5133a.5.5 0 0 0 .342-.4707l.012-1.6242c.0025-.3366.3301-.5746.651-.473l1.5484.4906a.5.5 0 0 0 .5534-.1798l.9644-1.307z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M10 8c0 1.1046-.8954 2-2 2s-2-.8954-2-2 .8954-2 2-2 2 .8954 2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},ptBS:function(e,r,t){var s=t("ziER"),i=t("5JeM"),n=new s({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},vgq2:function(e,r,t){var s=t("ziER"),i=t("5JeM"),n=new s({id:"icon-medium-discussion",use:"icon-medium-discussion-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-discussion"><path d="M8 21.4025a10.4446 10.4446 0 0 1-1.75-.8072L1 22l1.4318-5.2034C1.5217 15.2417 1 13.4318 1 11.5 1 5.701 5.701 1 11.5 1c4.5718 0 8.4611 2.9218 9.9025 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M9 16c0 3.866 3.134 7 7 7 1.3878 0 2.6812-.3803 3.7692-1.0769L23 23l-1.0769-3.2308C22.6197 18.6812 23 17.3878 23 16c0-3.866-3.134-7-7-7s-7 3.134-7 7z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><circle cx="13" cy="16" r=".5" /><circle cx="16" cy="16" r=".5" /><circle cx="19" cy="16" r=".5" /></symbol>'});i.add(n);e.exports=n},zdqs:function(e,r,t){"use strict";t.d(r,"a",(function(){return o}));var s=t("nsO7"),i=t("VdDF"),n=t("pjml"),o=function(){function e(e){this.termUtil=e,this.membershipTermMapper=new m(this.termUtil)}return e.prototype.getMembershipMapper=function(){return this.membershipTermMapper},e.prototype.map=function(e,r){var t=this;return e.map((function(e){return{membership:e,term:t.membershipTermMapper.adjustTerm(e,r)}}))},e}(),m=function(){function e(e){this.termUtil=e}return e.prototype.adjustTerm=function(e,r){var t=this.getCourseDateRange(e);return t.start>r?e.course.ui.term=this.termUtil.upcomingTerm:i.a.isWithinDateRange(r,t)?e.course.ui.term=this.termUtil.currentTerm:e.course.term?e.course.ui.term=e.course.term:e.course.ui.term=this.getTermMappingBasedOnCourseDates(e,t,r),e.course.ui.term},e.prototype.getCourseDateRange=function(e){var r,t;if(n.o.CourseDuration.DateRange.isEqualTo(e.course.durationType))r=e.course.startDate,t=e.course.endDate;else if(n.o.CourseDuration.FixedNumDays.isEqualTo(e.course.durationType))r=e.enrollmentDate,(t=new Date(e.enrollmentDate.getTime())).setDate(t.getDate()+e.course.numDaysOfUse);else if(n.o.CourseDuration.UseTerm.isEqualTo(e.course.durationType)){var s=e.course.term?this.termUtil.getTerm(e.course.term.id):null;s&&(n.Nb.TermDuration.DateRange.isEqualTo(s.durationType)?(r=s.startDate,t=s.endDate):n.Nb.TermDuration.FixedNumDays.isEqualTo(s.durationType)&&(r=e.enrollmentDate,(t=new Date(e.enrollmentDate.getTime())).setDate(t.getDate()+s.daysOfUse)))}return{end:t,start:r}},e.prototype.getTermMappingBasedOnCourseDates=function(e,r,t){var i=r.start||e.course.term&&e.course.term.startDate;if(!i){if(!(r.end&&t>r.end))return this.termUtil.currentTerm;i=r.end}var n=this.termUtil.filterTerm(i);if(0===n.length)return this.termUtil.createYearTerm(i);if(1===n.length)return n[0];if(n.length>1){var o=s.sortBy(n,["startDate","id"]);return o[o.length-1]}},e}()}}]);