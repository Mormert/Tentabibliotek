<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html lang="sv">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Operativsystem för civilingenjörer: Tentamen 2023-01-02</title>
<STYLE TYPE="text/css">
     P.breakhere {page-break-before: always}
</STYLE>
</head>

<body bgcolor="#ffffff" text="#000000" link="#0000cc" vlink="#551a8b" alink="#ff0000">

Örebro universitet
<br>
Institutionen för naturvetenskap och teknik
<br>
<a href="http://www.aass.oru.se/~tpy/">Thomas Padron-McCarthy</a>
(<a href="mailto:thomas.padron-mccarthy@oru.se?subject=Operativsystem för civilingenjörer: Tentamen 2023-01-02">thomas.padron-mccarthy@oru.se</a>)

<pre>






</pre>
<center>
<font size="+2">Tentamen i</font>
<p>
<font size="+4">Operativsystem</font>
<br>
<font size="+4">för civilingenjörer</font>  
<p>
måndag 2 januari 2023
<p>
<font size="-1">
Gäller som tentamen för:
<br>
DT513G Operativsystem för civilingenjörer, provkod A001
</font>
</center>

<p>

<hr noshade>

<p>

<table>
<tr><td valign="top">
<b>Hjälpmedel:</b>
</td><td valign="top">
Ordbok för översättning.
</td></tr>
<tr><td valign="top">
<b>Poängkrav:</b>
</td><td valign="top">
Maximal poäng är 38.
För godkänt betyg krävs 20 poäng.
</td></tr>
<tr><td valign="top">
<b>Resultat:</b>
</td><td valign="top">
Meddelas senast 15 arbetsdagar efter tentamensdatum.
</td></tr>
<tr><td valign="top">
<b>Återlämning av tentor:</b>
</td><td valign="top">
Elektroniskt via webbportalen Studenttjänster.
</td></tr>
<tr><td valign="top">
<b>Examinator och jourhavande:</b>
</td><td valign="top">
Thomas Padron-McCarthy, telefon 070 - 73 47 013.
</td></tr>
</table>

<p>

<hr noshade>

<p>

<font size="-1">
<ul>

<li>
Skriv tydligt och klart. Lösningar som inte går att läsa kan
naturligtvis inte ge några poäng.
Oklara och tvetydiga formuleringar kommer att misstolkas.

<li>
Skriv den personliga tentamenskoden på varje inlämnat blad.
Skriv <i>inte</i> namn eller personnummer på bladen.

<li>
Skriv bara på en sida av papperet.
Använd inte röd skrift.

<li>
Antaganden utöver de som står i uppgifterna måste anges. Gjorda
antaganden får inte förändra den givna uppgiften.

<li>
Skriv gärna förklaringar om hur du tänkt.
Även ett svar som är fel kan ge poäng,
om det finns med en förklaring som visar att huvudtankarna var rätt.
</ul>
</font>

<p>

<hr noshade>

<p>

<pre>




</pre>

<center>LYCKA TILL!</center>



<P CLASS="breakhere">



<h2>Formelsamling</h2>

<table border="1" cellspacing="0" cellpadding="3">
<td>2<sup>0</sup> = 1</td> <td>2<sup>24</sup> = 16777216</td></tr></td></tr>
<td>2<sup>1</sup> = 2</td> <td>2<sup>25</sup> = 33554432</td></tr>
<td>2<sup>2</sup> = 4</td> <td>2<sup>26</sup> = 67108864</td></tr>
<td>2<sup>3</sup> = 8</td> <td>2<sup>27</sup> = 134217728</td></tr>
<td>2<sup>4</sup> = 16</td> <td>2<sup>28</sup> = 268435456</td></tr>
<td>2<sup>5</sup> = 32</td> <td>2<sup>29</sup> = 536870912</td></tr>
<td>2<sup>6</sup> = 64</td> <td>2<sup>30</sup> = 1073741824</td></tr>
<td>2<sup>7</sup> = 128</td> <td>2<sup>31</sup> = 2147483648</td></tr>
<td>2<sup>8</sup> = 256</td> <td>2<sup>32</sup> = 4294967296</td></tr>
<td>2<sup>9</sup> = 512</td> <td>2<sup>33</sup> = 8589934592</td></tr>
<td>2<sup>10</sup> = 1024</td> <td>2<sup>34</sup> = 17179869184</td></tr>
<td>2<sup>11</sup> = 2048</td> <td>2<sup>35</sup> = 34359738368</td></tr>
<td>2<sup>12</sup> = 4096</td> <td>2<sup>36</sup> = 68719476736</td></tr>
<td>2<sup>13</sup> = 8192</td> <td>2<sup>37</sup> = 137438953472</td></tr>
<td>2<sup>14</sup> = 16384</td> <td>2<sup>38</sup> = 274877906944</td></tr>
<td>2<sup>15</sup> = 32768</td> <td>2<sup>39</sup> = 549755813888</td></tr>
<td>2<sup>16</sup> = 65536</td> <td>2<sup>40</sup> = 1099511627776</td></tr>
<td>2<sup>17</sup> = 131072</td> <td>2<sup>41</sup> = 2199023255552</td></tr>
<td>2<sup>18</sup> = 262144</td> <td>2<sup>42</sup> = 4398046511104</td></tr>
<td>2<sup>19</sup> = 524288</td> <td>2<sup>43</sup> = 8796093022208</td></tr>
<td>2<sup>20</sup> = 1048576</td> <td>2<sup>44</sup> = 17592186044416</td></tr>
<td>2<sup>21</sup> = 2097152</td> <td>2<sup>45</sup> = 35184372088832</td></tr>
<td>2<sup>22</sup> = 4194304</td> <td>2<sup>46</sup> = 70368744177664</td></tr>
<td>2<sup>23</sup> = 8388608</td> <td>2<sup>47</sup> = 140737488355328</td></tr>
</table>

<p>

2<sup>x</sup> * 2<sup>y</sup> = 2<sup>x+y</sup>
<br>
2<sup>x</sup> / 2<sup>y</sup> = 2<sup>x-y</sup>



<P CLASS="breakhere">



<a name="uppgift-1"></a>
<h2>Uppgift 1 (3 p)</h2>

På en tidigare tenta fanns en uppgift om ett C-program för Linux
som öppnar filen <b>foo.bin</b> med systemanropet <b>open</b>,
därefter skriver ganska mycket data med ett antal <b>write</b>-systemanrop,
och till slut stänger filen med systemanropet <b>close</b>.
Uppgiften handlade om att <b>close</b>-anropet ibland kunde ta mycket längre tid än
alla <b>write</b>-anropen, trots att man kanske tycker att
det är skrivningarna, med <b>write</b>, som borde ta längst tid,
medan <b>close</b> bara är en enkel administrativ operation som markerar att filen inte längre är öppen.
Det rätta svaret handlade om buffring, och att data kanske inte faktiskt skrevs förrän i <b>close</b>-anropet.

<p>

Nu skriver vi i stället ett C-program för Linux
som öppnar filen <b>foo.bin</b> med systemanropet <b>open</b>,
men nu för läsning och inte skrivning,
och därefter läser vi ganska mycket data med ett antal <b>read</b>-systemanrop.
Till slut stänger vi filen med systemanropet <b>close</b>.
Kan det bli likadant nu, att <b>close</b>-anropet tar väldigt lång tid? Förklara!



<a name="uppgift-2"></a>
<h2>Uppgift 2 (4 p)</h2>

Vad är de viktigaste skillnaderna mellan en process och en tråd?

<p>

När kan det vara lämpligt att använda en tråd, och när kan det vara lämpligt att använda en process?



<a name="uppgift-3"></a>
<h2>Uppgift 3 (3 p)</h2>

Det här är ett C-program för Linux.
Vad skrivs ut när vi kör programmet?
Förklara också varför det blir så!

<p>

<table border="1" cellspacing="0" cellpadding="3"><tr><td bgcolor="#ccffcc">
<pre>
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main(void) {
    int forks = 0;
    fork();
    ++forks;
    fork();
    ++forks;
    fork();
    ++forks;
    printf("forks = %d\n", forks);
} // main
</pre>
</td></tr></table>



<P CLASS="breakhere">



<a name="uppgift-4"></a>
<h2>Uppgift 4 (9 p)</h2>

Det här är ett C-program för Linux.
Det startar tusen trådar,
som var och en tusen gånger ökar variabeln <b>data</b> med ett.
Till slut innehåller variabeln en miljon.

<p>

<table border="1" cellspacing="0" cellpadding="3"><tr><td bgcolor="#ccffcc">
<pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;

#define NR_THREADS 1000
#define NR_ITERATIONS 1000

volatile long long int data = 0;
pthread_mutex_t lock;

static void *thread_body(void *arg) {
    for (int i = 0; i &lt; NR_ITERATIONS; i++) {
        pthread_mutex_lock(&amp;lock);
        ++data;
        pthread_mutex_unlock(&amp;lock);
    }
    return NULL;
} // thread_body

int main(void) {
    pthread_t threads[NR_THREADS];
    pthread_mutex_init(&amp;lock, NULL);

    for (int i = 0; i &lt; NR_THREADS; ++i) {
        pthread_create(&amp;threads[i], NULL, thread_body, NULL);
    }

    for (int i = 0; i &lt; NR_THREADS; ++i) {
        pthread_join(threads[i], NULL);
    }

    printf("All threads have finished.\n");
    printf("Result: data = %lld\n", data);
} // main
</pre>
</td></tr></table>

<p>

a) Beskriv vad som händer om vi byter ut funktionen <b>thread_body</b> mot den här:

<p>

<table border="1" cellspacing="0" cellpadding="3"><tr><td bgcolor="#ccffcc">
<pre>
static void *thread_body(void *arg) {
    for (int i = 0; i &lt; NR_ITERATIONS; i++) {
        ++data;
    }
    return NULL;
} // thread_body
</pre>
</td></tr></table>

<p>

b) Beskriv vad som händer om vi i stället byter ut <b>thread_body</b> mot den här:

<p>

<table border="1" cellspacing="0" cellpadding="3"><tr><td bgcolor="#ccffcc">
<pre>
static void *thread_body(void *arg) {
    pthread_mutex_lock(&amp;lock);
    for (int i = 0; i &lt; NR_ITERATIONS; i++) {
        ++data;
    }
    pthread_mutex_unlock(&amp;lock);
    return NULL;
} // thread_body
</pre>
</td></tr></table>



<P CLASS="breakhere">



c) Beskriv vad som händer om vi behåller den ursprungliga <b>thread_body</b>,
men byter ut <b>main</b>-funktionen mot den här:

<p>

<table border="1" cellspacing="0" cellpadding="3"><tr><td bgcolor="#ccffcc">
<pre>
int main(void) {
    pthread_t threads[NR_THREADS];
    pthread_mutex_init(&amp;lock, NULL);

    for (int i = 0; i &lt; NR_THREADS; ++i) {
        pthread_create(&amp;threads[i], NULL, thread_body, NULL);
        pthread_join(threads[i], NULL);
    }

    printf("All threads have finished.\n");
    printf("Result: data = %lld\n", data);
} // main
</pre>
</td></tr></table>




<a name="uppgift-5"></a>
<h2>Uppgift 5 (5 p)</h2>

Vi har en byteadresserad dator som arbetar med virtuellt minne,
där både virtuella och fysiska adresser består av 20 bitar,
så man kan adressera som mest 1048576 byte.
Det är också så mycket fysiskt minne som datorn har.
I de virtuella adresserna utgörs 10 bitar av sidnummer och 10 bitar av offset inom sidan.

<p>

a) Om den virtuella adressrymden är lika stor som det fysiska minnet,
vad är det då för mening med virtuellt minne och översättning av minnesadresser?
Man skulle väl lika gärna kunna använda fysiska adresser direkt?
Förklara!

<p>

b) Den virtuella minnessidan 0 är lagrad i frame 1,
och den virtuella minnessidan 1 är lagrad i frame 0.
Visa hur den virtuella adressen <b>1025</b> översätts till en fysisk minnesadress,
och vad den fysiska adressen blir.



<a name="uppgift-6"></a>
<h2>Uppgift 6 (5 p)</h2>

För schemaläggningen ("schedulering") av processer används flera olika köer där processerna placeras.

<p>

a) Förklara vilka det är, och vad man har varje kö till!

<p>

b) Var finns dessa köer?



<a name="uppgift-7"></a>
<h2>Uppgift 7 (6 p)</h2>

a) Vad menas <b>spinlock</b> och <b>busy-wait</b> (även kallat <b>spinning</b>)?

<p>

b) Ge exempel på när det kan vara lämpligt för operativsystemkärnan att använda dessa.

<p>

c) Under vilka omständigheter bör operativsystemkärnan absolut <i>inte</i> använda dessa?

<p>

d) Varför är det normalt inte lämpligt att använda dem i vanliga program?



<P CLASS="breakhere">



<a name="uppgift-8"></a>
<h2>Uppgift 8 (3 p)</h2>

Vad går fortast av ett systemanrop och ett vanligt funktionsanrop?

<p>

Vad beror skillnaden på?

<p>

<hr noshade>

</body>
</html>
